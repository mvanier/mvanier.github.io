<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Part A: Programming in Imp &mdash; The CS 131 book</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="prev" title="Preamble" href="Preamble.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            The CS 131 book, Spring 2023
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Software.html">Installing the course software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lectures.html">Lectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin/index.html">Administrative information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Assignments</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Assignment 1: The <em>Imp</em> language</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Preamble.html">Preamble</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Part A: Programming in <em>Imp</em></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sigma">1. <code class="docutils literal notranslate"><span class="pre">sigma</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#exp-and-log">2. <code class="docutils literal notranslate"><span class="pre">exp</span></code> and <code class="docutils literal notranslate"><span class="pre">log</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fact">3. <code class="docutils literal notranslate"><span class="pre">fact</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fib">4. <code class="docutils literal notranslate"><span class="pre">fib</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#binary">5. <code class="docutils literal notranslate"><span class="pre">binary</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#part-b-extending-imp">Part B: Extending <em>Imp</em></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#read">1. <code class="docutils literal notranslate"><span class="pre">read</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-syntactic-sugar">2. Adding syntactic sugar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#and-and-or">3. <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#improving-while-and-begin">4. Improving <code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">begin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-support-for-local-variables">5. Adding support for local variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#part-c-programming-in-extended-imp">Part C: Programming in extended <em>Imp</em></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">The CS 131 book, Spring 2023</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Assignments</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Assignment 1: The <em>Imp</em> language</a></li>
      <li class="breadcrumb-item active">Part A: Programming in <em>Imp</em></li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="part-a-programming-in-imp">
<h1>Part A: Programming in <em>Imp</em><a class="headerlink" href="#part-a-programming-in-imp" title="Permalink to this heading"></a></h1>
<p>In this section you will write a few functions in the base <em>Imp</em>
language to familiarize yourself with how it works. This code will go in
the file <code class="docutils literal notranslate"><span class="pre">lab1a.imp</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You are allowed to write helper functions in addition to the
functions described.</p>
<p>Since <em>Imp</em> doesn’t (yet) have local variables other than function
arguments (you’ll implement this in part B), if you need them you can
either</p>
<ul class="simple">
<li><p>define a global variable instead</p></li>
<li><p>write a helper function with extra arguments which you use as
local variables</p></li>
</ul>
<p>The second strategy should be familiar from CS 4. Note that you can
change the values of function arguments using the <code class="docutils literal notranslate"><span class="pre">set</span></code> form.</p>
</div>
<section id="sigma">
<h2>1. <code class="docutils literal notranslate"><span class="pre">sigma</span></code><a class="headerlink" href="#sigma" title="Permalink to this heading"></a></h2>
<p>Define a function <code class="docutils literal notranslate"><span class="pre">sigma</span></code> satisfying
<code class="docutils literal notranslate"><span class="pre">(sigma</span> <span class="pre">m</span> <span class="pre">n)</span> <span class="pre">=</span> <span class="pre">m</span> <span class="pre">+</span> <span class="pre">(m+1)</span> <span class="pre">+</span> <span class="pre">...</span> <span class="pre">+</span> <span class="pre">n</span></code>. When <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">&gt;</span> <span class="pre">n</span></code>, the behavior
of <code class="docutils literal notranslate"><span class="pre">sigma</span></code> is unspecified; your implementation may do anything you
like. Write two versions of this function. <code class="docutils literal notranslate"><span class="pre">sigma1</span></code> will work
recursively while <code class="docutils literal notranslate"><span class="pre">sigma2</span></code> will work imperatively using a <code class="docutils literal notranslate"><span class="pre">while</span></code>
loop.</p>
</section>
<section id="exp-and-log">
<h2>2. <code class="docutils literal notranslate"><span class="pre">exp</span></code> and <code class="docutils literal notranslate"><span class="pre">log</span></code><a class="headerlink" href="#exp-and-log" title="Permalink to this heading"></a></h2>
<p>Define functions <code class="docutils literal notranslate"><span class="pre">exp</span></code> and <code class="docutils literal notranslate"><span class="pre">log</span></code>. When base <code class="docutils literal notranslate"><span class="pre">b</span></code> and exponent <code class="docutils literal notranslate"><span class="pre">n</span></code>
are nonnegative, <code class="docutils literal notranslate"><span class="pre">(exp</span> <span class="pre">b</span> <span class="pre">n)</span> <span class="pre">=</span> <span class="pre">b^n</span></code>, and when <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>,
<code class="docutils literal notranslate"><span class="pre">(log</span> <span class="pre">b</span> <span class="pre">m)</span></code> is the smallest integer <code class="docutils literal notranslate"><span class="pre">n</span></code> such that <code class="docutils literal notranslate"><span class="pre">b^(n</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">&gt;</span> <span class="pre">m</span></code>.
(We’re using the <code class="docutils literal notranslate"><span class="pre">^</span></code> symbol to mean “to the power of” here.) On inputs
that don’t satisfy the preconditions, your implementation may do
anything you like — even fail to terminate.</p>
</section>
<section id="fact">
<h2>3. <code class="docutils literal notranslate"><span class="pre">fact</span></code><a class="headerlink" href="#fact" title="Permalink to this heading"></a></h2>
<p>Define a function <code class="docutils literal notranslate"><span class="pre">fact</span></code> such that <code class="docutils literal notranslate"><span class="pre">(fact</span> <span class="pre">n)</span></code> is the factorial of
<code class="docutils literal notranslate"><span class="pre">n</span></code>. Define two versions of this function. The first (<code class="docutils literal notranslate"><span class="pre">fact1</span></code>) will
be a simply-recursive function that is familiar from the definition of
factorials. The second (<code class="docutils literal notranslate"><span class="pre">fact2</span></code>) will be an imperative function using
a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop.</p>
</section>
<section id="fib">
<h2>4. <code class="docutils literal notranslate"><span class="pre">fib</span></code><a class="headerlink" href="#fib" title="Permalink to this heading"></a></h2>
<p>Define a function <code class="docutils literal notranslate"><span class="pre">fib</span></code> such that <code class="docutils literal notranslate"><span class="pre">(fib</span> <span class="pre">n)</span></code> is the <code class="docutils literal notranslate"><span class="pre">n</span></code>th
Fibonacci number. The Fibonacci numbers are a sequence of numbers
defined by these laws:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>fib 0 = 0
fib 1 = 1
fib n = fib (n - 1) + fib (n - 2)  when n &gt; 1
</pre></div>
</div>
<p>Do two versions of this function. <code class="docutils literal notranslate"><span class="pre">fib1</span></code> will be the usual
tree-recursive function that corresponds to the definition, but it will
be extremely slow for large input values. <code class="docutils literal notranslate"><span class="pre">fib2</span></code> will be an imperative
function using a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop and will be fast.</p>
</section>
<section id="binary">
<h2>5. <code class="docutils literal notranslate"><span class="pre">binary</span></code><a class="headerlink" href="#binary" title="Permalink to this heading"></a></h2>
<p>Define a function <code class="docutils literal notranslate"><span class="pre">binary</span></code> such that <code class="docutils literal notranslate"><span class="pre">(binary</span> <span class="pre">m)</span></code> is the number
whose decimal representation looks like the binary representation of
<code class="docutils literal notranslate"><span class="pre">m</span></code>. For example <code class="docutils literal notranslate"><span class="pre">(binary</span> <span class="pre">12)</span> <span class="pre">=</span> <span class="pre">1100</span></code>, since <code class="docutils literal notranslate"><span class="pre">11002</span></code> =
12<sub>10</sub>. You can assume that the input <code class="docutils literal notranslate"><span class="pre">m</span></code> is non-negative.</p>
</section>
</section>
<section id="part-b-extending-imp">
<h1>Part B: Extending <em>Imp</em><a class="headerlink" href="#part-b-extending-imp" title="Permalink to this heading"></a></h1>
<section id="read">
<h2>1. <code class="docutils literal notranslate"><span class="pre">read</span></code><a class="headerlink" href="#read" title="Permalink to this heading"></a></h2>
<p>Add the primitive <code class="docutils literal notranslate"><span class="pre">read</span></code> to the <em>Imp</em> interpreter and the initial
basis. Function <code class="docutils literal notranslate"><span class="pre">read</span></code> is executed for its side effect; it takes no
arguments, reads a number from standard input, and returns the number.
The <code class="docutils literal notranslate"><span class="pre">read</span></code> primitive reads an entire line before converting it to an
integer. If the input is invalid, it should raise a <code class="docutils literal notranslate"><span class="pre">Runtime_err</span></code>
exception with an appropriate error message.</p>
<p>Note that OCaml provides the <code class="docutils literal notranslate"><span class="pre">read_line</span></code> function as a built-in
function (in the <code class="docutils literal notranslate"><span class="pre">Stdlib</span></code> module). You can use it, or alternatively
use <code class="docutils literal notranslate"><span class="pre">read_int</span></code> or <code class="docutils literal notranslate"><span class="pre">read_int_opt</span></code> to read the number.</p>
</section>
<section id="adding-syntactic-sugar">
<h2>2. Adding syntactic sugar<a class="headerlink" href="#adding-syntactic-sugar" title="Permalink to this heading"></a></h2>
<p>One interesting way to extend a language is to add <em>syntactic sugar</em> to
it. This means to add forms that are trivially convertible to existing
forms. For this problem, we want you to add a few language forms
<em>without</em> changing the abstract syntax tree (AST) representation of the
language. Instead, extend the S-expression to AST conversion (the
<code class="docutils literal notranslate"><span class="pre">parse_expr</span></code> function) so that it recognizes the following forms and
emits the correct AST forms.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is <em>not</em> usually the best way to add syntactic sugar to a
language. An alternative way, which we’ll explore in other languages,
is to convert the AST to a simpler AST (an intermediate
representation). Working with bare S-expressions in OCaml is fairly
tedious. On the other hand, Scheme and Racket macros are a very
sophisticated user-programmable way to add syntactic sugar to the
Scheme and Racket languages, and they work by converting
S-expressions to other S-expressions (to a first approximation).</p>
</div>
<p>In each case, if a syntax error arises, a <code class="docutils literal notranslate"><span class="pre">Syntax_err</span></code> exception must
be raised with a meaningful error message.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t forget to add any new keywords to the <code class="docutils literal notranslate"><span class="pre">keywords</span></code> list in the
interpreter!</p>
</div>
<section id="a-do-while">
<h3>a. <code class="docutils literal notranslate"><span class="pre">do-while</span></code><a class="headerlink" href="#a-do-while" title="Permalink to this heading"></a></h3>
<p>Add a C-like <code class="docutils literal notranslate"><span class="pre">do-while</span></code> form with this translation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(do-while &lt;exp&gt; &lt;test-exp&gt;) ==&gt; (begin &lt;exp&gt; (while &lt;test-exp&gt; &lt;exp&gt;))
</pre></div>
</div>
<div class="example admonition">
<p class="admonition-title">Example</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; (val x 5)
variable x = 5
&gt;&gt;&gt; (do-while (println x) (set x (- x 1)))
5
4
3
2
1
0
</pre></div>
</div>
</div>
</section>
<section id="b-while">
<h3>b. <code class="docutils literal notranslate"><span class="pre">while*</span></code><a class="headerlink" href="#b-while" title="Permalink to this heading"></a></h3>
<p>Add a <code class="docutils literal notranslate"><span class="pre">while*</span></code> form with this translation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(while* &lt;test-exp&gt; &lt;exp1&gt; &lt;exp2&gt; ... &lt;expN&gt;)
  ==&gt; (while &lt;test-exp&gt; (begin &lt;exp1&gt; &lt;exp2&gt; ... &lt;expN&gt;))
</pre></div>
</div>
<p>This allows you to write <code class="docutils literal notranslate"><span class="pre">while</span></code> loops without having an explicit
<code class="docutils literal notranslate"><span class="pre">begin</span></code>. A <code class="docutils literal notranslate"><span class="pre">while*</span></code> expression with no non-test expressions is a
syntax error, as is one with no expressions at all.</p>
<div class="example admonition">
<p class="admonition-title">Example</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; (val x 5)
variable x = 5
&gt;&gt;&gt; (while* (&gt; x 0) (println x) (set x (- x 1)))
5
4
3
2
1
0
</pre></div>
</div>
</div>
</section>
<section id="c-for">
<h3>c. <code class="docutils literal notranslate"><span class="pre">for</span></code><a class="headerlink" href="#c-for" title="Permalink to this heading"></a></h3>
<p>Add a C-like <code class="docutils literal notranslate"><span class="pre">for</span></code> loop with this translation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(for &lt;begin-exp&gt; &lt;test-exp&gt; &lt;incr-exp&gt; (&lt;body-exp1&gt; &lt;body-exp2&gt; ... &lt;body-expN))
==&gt;
(begin &lt;begin-exp&gt;
  (while &lt;test-exp&gt;
    (begin &lt;body-exp1&gt; &lt;body-exp2&gt; ... &lt;body-expN&gt; &lt;incr-exp&gt;)))
</pre></div>
</div>
<div class="example admonition">
<p class="admonition-title">Example</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; (val x 0)
variable x = 0
&gt;&gt;&gt; (val n 0)
variable n = 0
&gt;&gt;&gt; (for (set x 5) (&gt; x 0) (set x (- x 1)) ((println x) (set n (+ n 1))))
5
4
3
2
1
0
&gt;&gt;&gt; n
5
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t forget the parentheses around the body expressions!
Think of it as a <code class="docutils literal notranslate"><span class="pre">begin</span></code> expression without the <code class="docutils literal notranslate"><span class="pre">begin</span></code> keyword.</p>
</div>
<p>Note that for all of these changes, you will have to decide what the
location of the newly-created forms are. Here are some guidelines:</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">do-while</span></code>, use the <code class="docutils literal notranslate"><span class="pre">do-while</span></code> location for the generated
<code class="docutils literal notranslate"><span class="pre">begin</span></code> and <code class="docutils literal notranslate"><span class="pre">while</span></code> forms.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">while*</span></code>, use the <code class="docutils literal notranslate"><span class="pre">while*</span></code> location for the generated
<code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">begin</span></code> forms.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">for</span></code>, use the <code class="docutils literal notranslate"><span class="pre">for</span></code> location for the outer generated
<code class="docutils literal notranslate"><span class="pre">begin</span></code> form and the generated <code class="docutils literal notranslate"><span class="pre">while</span></code> form. For the inner
generated <code class="docutils literal notranslate"><span class="pre">begin</span></code> form, use the location of the S-expression
<code class="docutils literal notranslate"><span class="pre">List</span></code> constructor that contains the <code class="docutils literal notranslate"><span class="pre">begin</span></code> expressions.</p></li>
<li><p>For expressions that pass through unchanged, keep the location the
same.</p></li>
</ul>
</section>
</section>
<section id="and-and-or">
<h2>3. <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code><a class="headerlink" href="#and-and-or" title="Permalink to this heading"></a></h2>
<p>The initial basis of the <em>Imp</em> language is split between primitive
functions and user functions. The user functions are defined in the
string <code class="docutils literal notranslate"><span class="pre">initial_basis</span></code> near the end of the file. Two of these
definitions are quite unsatisfying:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(define and (b c) (if b c b))
(define or (b c) (if b b c))
</pre></div>
</div>
<p>The reason these are bad is that <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code> should have
short-circuit semantics: if the first argument is <code class="docutils literal notranslate"><span class="pre">0</span></code> (for <code class="docutils literal notranslate"><span class="pre">and</span></code>) or
<code class="docutils literal notranslate"><span class="pre">1</span></code> (for <code class="docutils literal notranslate"><span class="pre">or</span></code>) the second argument should never be evaluated. In
this problem we will implement a correct version of <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code>
with the appropriate semantics.</p>
<p>Before we begin, note that this <em>could</em> be done the same way we
implemented <code class="docutils literal notranslate"><span class="pre">while*</span></code> and <code class="docutils literal notranslate"><span class="pre">do-while</span></code>: by making <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code>
syntactic sugar for <code class="docutils literal notranslate"><span class="pre">if</span></code> expressions. However, it’s instructive to do
it a different way. Here is what we want you to do:</p>
<ol class="arabic simple">
<li><p>Remove the definitions of <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code> from the
<code class="docutils literal notranslate"><span class="pre">initial_basis</span></code> string.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code> to the keywords list.</p></li>
<li><p>Extend the AST <code class="docutils literal notranslate"><span class="pre">exp</span></code> type definition with two new constructors:
<code class="docutils literal notranslate"><span class="pre">And</span> <span class="pre">(&lt;loc&gt;,</span> <span class="pre">&lt;exp&gt;,</span> <span class="pre">&lt;exp&gt;)</span></code> and <code class="docutils literal notranslate"><span class="pre">Or</span> <span class="pre">(&lt;loc&gt;,</span> <span class="pre">&lt;exp&gt;,</span> <span class="pre">&lt;exp&gt;)</span></code>.</p></li>
<li><p>Extend <code class="docutils literal notranslate"><span class="pre">parse_expr</span></code> so that the S-expression corresponding to
<code class="docutils literal notranslate"><span class="pre">(and</span> <span class="pre">&lt;exp&gt;</span> <span class="pre">&lt;exp&gt;)</span></code> gets converted to the corresponding AST form
and similarly for <code class="docutils literal notranslate"><span class="pre">(or</span> <span class="pre">&lt;exp&gt;</span> <span class="pre">&lt;exp&gt;)</span></code>.</p></li>
<li><p>Extend <code class="docutils literal notranslate"><span class="pre">eval_expr</span></code> with cases for <code class="docutils literal notranslate"><span class="pre">And</span></code> and <code class="docutils literal notranslate"><span class="pre">Or</span></code> AST forms.
These should just dispatch to <code class="docutils literal notranslate"><span class="pre">If</span></code> AST forms according to the
rules:</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>And (l, e1, e2) ==&gt; If (l, e1, e2, e1)
Or (l, e1, e2) ==&gt; If (l, e1, e1, e2)
</pre></div>
</div>
<p>with one caveat: make sure you do not compute the value of <code class="docutils literal notranslate"><span class="pre">e1</span></code> or
<code class="docutils literal notranslate"><span class="pre">e2</span></code> more than once. (There are different ways to achieve this.)</p>
<p>Again, make sure that the locations used in derived forms are reasonable ones.</p>
</section>
<section id="improving-while-and-begin">
<h2>4. Improving <code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">begin</span></code><a class="headerlink" href="#improving-while-and-begin" title="Permalink to this heading"></a></h2>
<p>The way that <code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">begin</span></code> expressions are evaluated in the
<code class="docutils literal notranslate"><span class="pre">eval_expr</span></code> function is somewhat inefficient. In both cases, we
sometimes have to create new <code class="docutils literal notranslate"><span class="pre">while</span></code>/<code class="docutils literal notranslate"><span class="pre">begin</span></code> expressions and
evaluate them in order to evaluate the full expression (this was spelled
out in the operational semantics). However, why should we dispatch the
<code class="docutils literal notranslate"><span class="pre">while</span></code>/<code class="docutils literal notranslate"><span class="pre">begin</span></code> subexpression to <code class="docutils literal notranslate"><span class="pre">eval_expr</span></code> just so it can wind
up in the exact same point in the code we are already in? The extra case
analysis is completely unnecessary. Rewrite the code for these forms so
that you never have to recurse on a newly-created <code class="docutils literal notranslate"><span class="pre">while</span></code> or <code class="docutils literal notranslate"><span class="pre">begin</span></code>
subexpression.</p>
<p>There are two ways to do this: imperatively and functionally. The
imperative way would use an OCaml <code class="docutils literal notranslate"><span class="pre">while</span></code> loop and reference
variables. We want you to do it the other way: using a tail-recursive
helper function (for <code class="docutils literal notranslate"><span class="pre">while</span></code>) or using either a tail-recursive helper
function or an equivalent higher-order function (for <code class="docutils literal notranslate"><span class="pre">begin</span></code>).</p>
</section>
<section id="adding-support-for-local-variables">
<h2>5. Adding support for local variables<a class="headerlink" href="#adding-support-for-local-variables" title="Permalink to this heading"></a></h2>
<p>One glaring weakness of the <em>Imp</em> language is that it has no local
variables, even though it has an environment for storing them. In this
problem we will implement them.</p>
<p>The syntax for function definitions will change to the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(define function-name (formals) {(locals &lt;locals&gt;)} expression)
</pre></div>
</div>
<p>The curly braces are not part of the concrete syntax; they mean that the
<code class="docutils literal notranslate"><span class="pre">locals</span></code> declaration can be omitted, in which case the locals list is
empty. In other words:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(define foo (x y z) &lt;exp&gt;)
</pre></div>
</div>
<p>is the same as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(define foo (x y z) (locals) &lt;exp&gt;)  ; empty locals list
</pre></div>
</div>
<p>Here’s an example of a function that uses locals:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(define dumb-add (x y z)
  (locals sum)
  (begin
    (set sum x)
    (set sum (+ sum y))
    (set sum (+ sum z))
    sum))
</pre></div>
</div>
<p>Here’s the function being called:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; (dumb-add 1 2 3)
6
</pre></div>
</div>
<p>Here are the steps we want you to go through to implement locals:</p>
<ol class="arabic simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">locals</span></code> to the keywords list.</p></li>
<li><p>Extend the <code class="docutils literal notranslate"><span class="pre">Define</span></code> AST form in the <code class="docutils literal notranslate"><span class="pre">def</span></code> type to contain a list
of identifiers corresponding to local variables. This list should be
separate from the <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">list</span></code> of function arguments.</p></li>
<li><p>Extend <code class="docutils literal notranslate"><span class="pre">parse_def</span></code> so that it recognizes function definitions with
locals and parses them to the new <code class="docutils literal notranslate"><span class="pre">Define</span></code> form. Function
definitions without locals will also be parsed to the new <code class="docutils literal notranslate"><span class="pre">Define</span></code>
form, but the locals list will be empty. Check that all the locals
identifiers are valid and that they are unique (as is currently done
for the function parameters). Note that it’s OK to use the same name
for a local variable and a function parameter; in such cases, the
local variable takes precedence.</p></li>
<li><p>Extend the <code class="docutils literal notranslate"><span class="pre">UserFunction</span></code> definition so it includes locals.</p></li>
<li><p>When a function call with a <code class="docutils literal notranslate"><span class="pre">UserFunction</span></code> is evaluated, all locals
are added to the local variable environment with an initial value of
<code class="docutils literal notranslate"><span class="pre">0</span></code>. Then evaluation proceeds normally.</p></li>
</ol>
<p>Try to do this without copying code unnecessarily.</p>
</section>
</section>
<section id="part-c-programming-in-extended-imp">
<h1>Part C: Programming in extended <em>Imp</em><a class="headerlink" href="#part-c-programming-in-extended-imp" title="Permalink to this heading"></a></h1>
<p>Rewrite your functions from part A as follows. Even if you used helper
functions to implement your functions in part A (which is allowed),
don’t do that here; all functions should be self-contained. Also, none
of these functions should use recursion.</p>
<ul class="simple">
<li><p>Rewrite the <code class="docutils literal notranslate"><span class="pre">sigma2</span></code> function so it uses <code class="docutils literal notranslate"><span class="pre">while*</span></code> and local
variable(s). Call the new function <code class="docutils literal notranslate"><span class="pre">sigma3</span></code>.</p></li>
<li><p>Rewrite <code class="docutils literal notranslate"><span class="pre">exp</span></code> so it uses <code class="docutils literal notranslate"><span class="pre">while*</span></code> and local variable(s). Call the
new version <code class="docutils literal notranslate"><span class="pre">exp2</span></code>.</p></li>
<li><p>Define a version of <code class="docutils literal notranslate"><span class="pre">fact</span></code> which uses local variable(s) and a
<code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Call it <code class="docutils literal notranslate"><span class="pre">fact3</span></code>.</p></li>
<li><p>Define a version of <code class="docutils literal notranslate"><span class="pre">fib</span></code> which uses local variable(s) and a
<code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Call it <code class="docutils literal notranslate"><span class="pre">fib3</span></code>.</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Preamble.html" class="btn btn-neutral float-left" title="Preamble" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Michael C. Vanier. All rights reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>