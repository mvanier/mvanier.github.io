
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mvanier.github.io/cs115/Spring2025/book/assignments/6/partC_Sexpr/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Part C: Extending an S-expression parser (25 points) - The CS 115 book (Spring 2025)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-c-extending-an-s-expression-parser-25-points" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="The CS 115 book (Spring 2025)" class="md-header__button md-logo" aria-label="The CS 115 book (Spring 2025)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The CS 115 book (Spring 2025)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part C: Extending an S-expression parser (25 points)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to medium mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to medium mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="medium" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18V6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="The CS 115 book (Spring 2025)" class="md-nav__button md-logo" aria-label="The CS 115 book (Spring 2025)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The CS 115 book (Spring 2025)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to CS 115!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing the course software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Books and resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/papers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interesting papers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administrative
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administrative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin/syllabus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Syllabus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin/collab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Collaboration policies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Assignments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Assignments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0/assignment0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment 0: Getting set up
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-code-and-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Template code and testing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-simplifying-the-sexpr-datatype" class="md-nav__link">
    <span class="md-ellipsis">
      1. Simplifying the Sexpr datatype
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-generalized-parentheses" class="md-nav__link">
    <span class="md-ellipsis">
      2. Generalized parentheses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-why-not-try" class="md-nav__link">
    <span class="md-ellipsis">
      3. Why not try?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-better-floats" class="md-nav__link">
    <span class="md-ellipsis">
      4. Better floats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-adding-strings-to-the-atom-datatype" class="md-nav__link">
    <span class="md-ellipsis">
      5. Adding strings to the Atom datatype
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="part-c-extending-an-s-expression-parser-25-points">Part C: Extending an S-expression parser (25 points)</h1>
<p>In lecture 21,
we created a very simple S-expression parser for a Scheme-like language.
In this section you will extend the S-expression parser in several ways
to get some practice working with parser combinators.</p>
<p>While doing this,
you should be aware that there is nothing about an S-expression parser
that necessarily connects it to the Scheme programming language.
Scheme does use S-expressions as the basis for its syntax
(though with lots of extensions,
such as the dot notation for improper lists),
but you could use S-expressions in other contexts as well,
and people do.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<h2 id="template-code-and-testing">Template code and testing</h2>
<p>The code used in the lecture is available in the file <code>Sexpr.hs</code>.
You will be modifying various parts of this code in this section.
There is also a file of sample Scheme-like code called <code>test.scm</code>.
Use this to test your parser.
You can test your parser interactively
by starting <code>ghci</code> and typing these lines:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ghci&gt; :set -package parsec
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>ghci&gt; :load Sexpr.hs
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>ghci&gt; runPpSexpr &quot;test.scm&quot;
</span></code></pre></div>
<p>This will load your code
and run the <code>runPpSexpr</code> function on the <code>test.scm</code> file.
This function will parse all the code
and output a "pretty-printed" version of the code representation.
(You may not think it's particularly pretty,
but it will display the data structures very explicitly.)
If the parser gives errors on any part of this code,
it isn't working properly.
Do <em>not</em> change the pretty-printer code itself
unless specifically indicated below.
(You will have to modify other parts of the code, of course.)
Note that you can also create your own file of S-expressions
and test it this way.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you create your own test file,
please call the file something other than <code>test.scm</code>
or you may break the tests in the <code>Makefile</code>.</p>
</div>
<p>As described in the preamble,
you can also test the code from the terminal by typing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$ make sexpr
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$ make sexpr_test
</span></code></pre></div>
<p>This tests that the output of running the parser on <code>test.scm</code>
is what was expected.
It does this by comparing the output to an expected output file.</p>
<h2 id="1-simplifying-the-sexpr-datatype">1. Simplifying the <code>Sexpr</code> datatype</h2>
<p>[<strong>5 points</strong>]</p>
<p>The parser given to you in the original version of the file <code>Sexpr.hs</code>
has these datatypes as the basic S-expression datatypes:</p>
<div class="language-haskell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kr">data</span><span class="w"> </span><span class="kt">Atom</span><span class="w"> </span><span class="ow">=</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="kt">BoolA</span><span class="w">  </span><span class="kt">Bool</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">IntA</span><span class="w">   </span><span class="kt">Integer</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">FloatA</span><span class="w"> </span><span class="kt">Double</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">IdA</span><span class="w">    </span><span class="kt">String</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kr">data</span><span class="w"> </span><span class="kt">Sexpr</span><span class="w"> </span><span class="ow">=</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="kt">AtomS</span><span class="w"> </span><span class="kt">Atom</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">ListS</span><span class="w"> </span><span class="p">[</span><span class="kt">Sexpr</span><span class="p">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">QuoteS</span><span class="w"> </span><span class="kt">Sexpr</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>Atom</code> type is fairly standard
(though we'll be extending it below),
but the <code>Sexpr</code> type itself is a bit odd.
There is actually no need
for the <code>QuoteS</code> constructor for quoted expressions.
If you know Scheme, you'll know that expression like these ones:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>&#39;a
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>&#39;(foo bar baz)
</span></code></pre></div>
<p>are actually syntactic sugar for these expressions:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>(quote a)
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>(quote (foo bar baz))
</span></code></pre></div>
<p>These S-expressions can be represented as <code>Sexpr</code> expressions without
the <code>QuoteS</code> constructor as follows:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>ListS [AtomS (IdA &quot;quote&quot;), AtomS (IdA &quot;a&quot;)]
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>ListS [AtomS (IdA &quot;quote&quot;),
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>       ListS [AtomS (IdA &quot;foo&quot;),
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>              AtomS (IdA &quot;bar&quot;),
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>              AtomS (IdA &quot;baz&quot;)]
</span></code></pre></div>
<p>Therefore, your first exercise
is to remove all the code dealing with the <code>QuoteS</code> constructor
(including the code in the pretty-printer <em>i.e.</em> the <code>ppSexpr</code> function).
Nevertheless, your parser must be able to parse quoted expressions,
converting them into S-expressions of the form given above.
The <code>Sexpr</code> datatype will become simply:</p>
<div class="language-haskell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kr">data</span><span class="w"> </span><span class="kt">Sexpr</span><span class="w"> </span><span class="ow">=</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="kt">AtomS</span><span class="w"> </span><span class="kt">Atom</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">ListS</span><span class="w"> </span><span class="p">[</span><span class="kt">Sexpr</span><span class="p">]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></code></pre></div>
<p>This exercise is mostly to get you familiar with the code base.
You won't be changing the way parsing is done,
but you will have to modify the function <code>parseSexpr</code>
and change the way quoted expressions are converted into <code>Sexpr</code>s.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You don't have to modify <code>parseQuote</code>, and you shouldn't.</p>
</div>
<h2 id="2-generalized-parentheses">2. Generalized parentheses</h2>
<p>[<strong>5 points</strong>]</p>
<p>Many (if not most) Schemes allow you
to use square brackets or curly braces
to delimit S-expressions instead of parentheses.
This is convenient in deeply-nested expressions;
you can easily tell visually where an expression starts and ends.
A closing square bracket can only match an opening square bracket,
and not an opening parenthesis (and similarly for curly braces).
In this exercise, you will extend the S-expression parser
to allow it to parse S-expressions using square brackets or curly braces.
Some examples:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>(this is an expression using parentheses)
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>[this is an expresssion using square brackets]
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>{this uses curly braces}
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>(this [weird expression] {uses all [kinds (of matching delimiters)]})
</span></code></pre></div>
<p>The delimiters must match, so if a particular list uses (say)
an open square bracket as the starting delimiter,
it must use a close square bracket as the ending delimiter.
(The same goes for parentheses and curly braces.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The delimiters have no significance in and of themselves,
so, for example,  the expression <code>(foo bar baz)</code>
is the same S-expression as <code>[foo bar baz]</code> or <code>{foo bar baz}</code>.</p>
</div>
<p>Modify the <code>parseList</code> function so that
it can parse S-expressions with any of the three types of delimiters.
The best way to do this is to define a helper function
which takes the two delimiter characters as arguments and outputs a parser,
and then use three such parsers in the body of <code>parseList</code>.
Use the <code>&lt;|&gt;</code> (alternation) operator
to combine the three parsers into one big parser.</p>
<p>The fact that a given S-expression
uses parentheses or square brackets or curly braces
is <em>not</em> encoded into the datatype;
the datatype doesn't care about
which delimiters were used for a given S-expression.</p>
<h2 id="3-why-not-try">3. Why not <code>try</code>?</h2>
<p>[<strong>5 points</strong>]</p>
<p>You don't need to use the <code>try</code> combinator in the <code>parseList</code> function
(in the event that you tried to parse one kind of delimiter and failed).
Why not? (Write the answer in a comment.)</p>
<h2 id="4-better-floats">4. Better floats</h2>
<p>[<strong>5 points</strong>]</p>
<p>The floating-point number parser in the template code is limited;
it can't handle floating-point numbers with exponents.
So these are valid floating-point numbers according to the parser:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>1.2
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>-3.4
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>42.12334
</span></code></pre></div>
<p>but these aren't:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>1.2e10
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>-3.4e-10
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>42.12334E+10
</span></code></pre></div>
<p>Modify the function <code>parseFloat</code>
to make it parse floating-point numbers with exponents.
Exponents are optional, but if present they have this syntax:
exponent letter (<code>e</code> or <code>E</code>), optional sign (<code>+</code> or <code>-</code> (or no sign)),
and one or more digits (<code>0</code> to <code>9</code>).</p>
<p>There are a couple of things you should know
about the floating-point number parser in the template code:</p>
<ul>
<li>
<p>Floating-point numbers are required to have a decimal point,
and at least one digit after the decimal point.
Most computer languages will accept floating-point numbers
without decimal points if <em>e.g.</em> an exponent is present,
but requiring the decimal point simplifies the parsing.
(Requiring a digit after the decimal point is also my personal preference;
I think that floating-point numbers
without digits after the decimal point look ugly <img alt="😄" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f604.svg" title=":smile:" />.)
You don't need to change any of this; it's just for your information.</p>
</li>
<li>
<p>The parser works by creating
a string version of the floating-point number
and then using the Haskell <code>read</code> function
to convert the string to a floating-point number.
This approach will still work with exponents,
but in this case
the string version of the floating-point number may have an exponent
(represented as a string concatenated
to the end of the rest of the floating-point number's
string representation).</p>
</li>
</ul>
<h2 id="5-adding-strings-to-the-atom-datatype">5. Adding strings to the <code>Atom</code> datatype</h2>
<p>[<strong>5 points</strong>]</p>
<p>Scheme includes strings as a basic data type,
but the <code>Atom</code> datatype in the parser doesn't support strings.
Change it to this type:</p>
<div class="language-haskell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kr">data</span><span class="w"> </span><span class="kt">Atom</span><span class="w"> </span><span class="ow">=</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kt">BoolA</span><span class="w">   </span><span class="kt">Bool</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">IntA</span><span class="w">    </span><span class="kt">Integer</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">FloatA</span><span class="w">  </span><span class="kt">Double</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">IdA</span><span class="w">     </span><span class="kt">String</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">StringA</span><span class="w"> </span><span class="kt">String</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">)</span>
</span></code></pre></div>
<p>As you can see,
now strings are a special kind of atom
which use the <code>StringA</code> constructor.
Extend the atom parser <code>parseAtom</code>
so that it can parse strings as well.
Do this by defining a parser called <code>parseString</code> which parses strings,
and then call that inside of <code>parseAtom</code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Inside <code>parseAtom</code>,
handle strings after integers but before identifiers.</p>
</div>
<p>The string syntax we'll use is extremely simple:
a string is a sequence of characters
between two double-quote (<code>"</code>) characters.
The double-quote character cannot occur in a string
(there is no backslash-escaping, for instance),
but you can put newline characters in a string directly
(you don't have to write <em>e.g.</em> <code>\n</code> for a newline,
and in fact that will give you two characters, not one).
Here are some example strings the parser can recognize:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>&quot;I am a string&quot;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>&quot;This string
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>spans
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>multiple lines&quot;
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>&quot;I can have &#39;single quotes&#39; inside but not double quotes&quot;
</span></code></pre></div>
<p>It isn't too hard to improve the string parser to handle backslash escapes,
but it isn't required.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Notably, there are popular OCaml libraries
which use S-expressions as a serialization format.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.footer", "navigation.top"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>