
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>OCaml notes &#8212; The CS 4 book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Part A: The environment model" href="partA_environment_model.html" />
    <link rel="prev" title="Details" href="Preamble.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">The CS 4 book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../admin/index.html">
   Administrative information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Syllabus.html">
     Syllabus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Collaboration_policies.html">
     Collaboration policies
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Motivation.html">
   Motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../History.html">
   History
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../0/Assignment0.html">
     Assignment 0: Getting set up
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../1/index.html">
     Assignment 1: Evaluation and recursion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partA_exercises.html">
       Part A: Basic exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partC_recursion.html">
       Part C: Recursion
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../2/index.html">
     Assignment 2: Asymptotic complexity and higher-order functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partA_orders_of_growth.html">
       Part A: Orders of growth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partC_higher_order_functions.html">
       Part C. Higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partD_additional_problems.html">
       Part D: Additional problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../3/index.html">
     Assignment 3: Lists
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partA_lists.html">
       Part A: Working with lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partB_structural_generative_recursion.html">
       Part B: Structural and generative recursion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partC_more_lists.html">
       Part C: Some harder problems with lists
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../4/index.html">
     Assignment 4: Data abstraction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partA_abstraction.html">
       Part A: Abstraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partB_more_abstraction.html">
       Part B: More abstraction problems
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partC_algebra.html">
       Part C: Miniproject: Algebraic expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../midterm/index.html">
     Midterm exam
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partA_complexity.html">
       Part A: Asymptotic time complexity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partB_lists_hofs.html">
       Part B: Recursion and higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partC_data_structures.html">
       Part C: Data structures: AA trees
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../5/index.html">
     Assignment 5: Tags and objects
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partA_mutation.html">
       Part A: Mutation and imperative programming
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partB_tagged_data.html">
       Part B: Tagged Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partC_objects.html">
       Part C: Objects
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Assignment 6: Environmentally-friendly
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Preamble.html">
       Details
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partA_environment_model.html">
       Part A: The environment model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partB_imperative_objects.html">
       Part B: Imperative objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partC_modules_functors.html">
       Part C: Modules and functors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partD_special_topics.html">
       Part D: Special topics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../7/index.html">
     Assignment 7: Final exam preparation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../7/sections/Preamble.html">
       Details
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../7/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../7/sections/miniproject_klotski.html">
       Miniproject: The “Klotski” sliding-block puzzle game
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../readings/index.html">
   Readings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/ocaml_cheat_sheet.html">
     OCaml syntax cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/subst.html">
     The substitution model
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing">
   Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environment-descriptions">
   Environment descriptions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-objects">
   More on objects
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-references">
     Self references
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#private-methods">
     Private methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modules-and-functors">
   Modules and functors
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>OCaml notes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing">
   Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environment-descriptions">
   Environment descriptions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-objects">
   More on objects
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-references">
     Self references
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#private-methods">
     Private methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modules-and-functors">
   Modules and functors
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="ocaml-notes">
<h1>OCaml notes<a class="headerlink" href="#ocaml-notes" title="Permalink to this headline">#</a></h1>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">#</a></h2>
<p>For this assignment, we are supplying you with these support files:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">.mli</span></code> OCaml interface file (<code class="docutils literal notranslate"><span class="pre">lab6.mli</span></code>)</p></li>
<li><p>a test script: (<code class="docutils literal notranslate"><span class="pre">tests_lab6.ml</span></code>)</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code></p></li>
</ul>
<p>These files are all available on the course Canvas site
in a single zip file called <code class="docutils literal notranslate"><span class="pre">lab6.zip</span></code>.
Download this file and use it as you’ve been doing with previous assignments.</p>
</section>
<section id="environment-descriptions">
<h2>Environment descriptions<a class="headerlink" href="#environment-descriptions" title="Permalink to this headline">#</a></h2>
<p>There is a problem in part A
that requires you to write a textual description
of the environments generated by evaluating some code
using the environment model described in lecture 13.
We’ll describe this process here.</p>
<p>Consider the following OCaml code:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">square</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">in</span> <span class="n">square</span> <span class="mi">100</span>
</pre></div>
</div>
<p>We would like to evaluate this using the environment model, and in the
process describe the environments created during its evaluation. This
was done in lecture 13 using diagrams, but note that you can do the same
thing using the following text description:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(*</span>
<span class="c">  -- Desugar expression to:</span>

<span class="c">  let square = fun x -&gt; x * x in square 100</span>

<span class="c">  -- Start with initial environment:</span>

<span class="c">  FRAME 0 (initial environment)</span>
<span class="c">    parent: none</span>
<span class="c">    bindings:</span>
<span class="c">      * : [primitive function *]</span>

<span class="c">  -- Evaluate the let expression:</span>
<span class="c">  --   Evaluate the fun expression:</span>

<span class="c">  FUNCTION 0 (fun x -&gt; x * x)</span>
<span class="c">    env: FRAME 0    (* environment function was defined in</span>
<span class="c">                       AKA enclosing environment *)</span>
<span class="c">    param: x</span>
<span class="c">    body: x * x</span>

<span class="c">  --   Create a new frame with the name &quot;square&quot; bound to the function object:</span>

<span class="c">  FRAME 1 (let square = FUNCTION 0 in ...)</span>
<span class="c">    parent: FRAME 0</span>
<span class="c">    bindings:</span>
<span class="c">      square : FUNCTION 0</span>

<span class="c">  --   Evaluate the expression &quot;square 100&quot; in the context of FRAME 1:</span>
<span class="c">  --     100 evaluates to itself</span>
<span class="c">  --     Look up &quot;square&quot; --&gt; FUNCTION 0</span>
<span class="c">  --     Apply FUNCTION 0 to 100:</span>
<span class="c">  --       Create a new frame, binding the formal parameter of the &quot;square&quot;</span>
<span class="c">  --         function:</span>

<span class="c">  FRAME 2  (FUNCTION 0 applied to 100)</span>
<span class="c">    parent: FRAME 0</span>
<span class="c">    bindings:</span>
<span class="c">      x : 100</span>

<span class="c">  -- Note that FRAME 2&#39;s parent is FRAME 0 because FUNCTION 0&#39;s enclosing</span>
<span class="c">  -- environment is FRAME 0.</span>

<span class="c">  --       Evaluate &quot;x * x&quot; in the context of FRAME 2:</span>
<span class="c">  --         Look up x: 100  (from FRAME 2)</span>
<span class="c">  --         Look up *: [primitive function *]  (from FRAME 0 via FRAME 2)</span>
<span class="c">  --         Apply * to 100, 100 --&gt; 10000</span>
<span class="c">  --         RESULT: 10000</span>
<span class="c">*)</span>
</pre></div>
</div>
<p>The environment description then would consist of all frames and
functions created during this evaluation:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(*</span>
<span class="c">  FRAME 0 (initial environment)</span>
<span class="c">    parent: none</span>
<span class="c">    bindings:</span>
<span class="c">      * : [primitive function *]</span>

<span class="c">  FUNCTION 0 (fun x -&gt; x * x)</span>
<span class="c">    env: FRAME 0</span>
<span class="c">    param: x</span>
<span class="c">    body: x * x</span>

<span class="c">  FRAME 1 (let square = FUNCTION 0 in ...)</span>
<span class="c">    parent: FRAME 0</span>
<span class="c">    bindings:</span>
<span class="c">      square : FUNCTION 0</span>

<span class="c">  FRAME 2  (FUNCTION 0 applied to 100)</span>
<span class="c">    parent: FRAME 0</span>
<span class="c">    bindings:</span>
<span class="c">      x : 100</span>
<span class="c">*)</span>
</pre></div>
</div>
<p>This is the kind of description we want you to produce. You don’t have
to describe the evaluation process step-by-step, but you need to be able
to do it in your head (or on paper), or you won’t get the right
frame/function contents. Pay particular attention to parents of frames;
it’s extremely easy to get those wrong.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember: applying a function to its arguments
creates a new frame whose parent frame
is the same as the <code class="docutils literal notranslate"><span class="pre">env</span></code> (enclosing environment)
of the function being applied.</p>
</div>
<p>Note that primitive functions don’t create frames when applied. Also,
only put the primitive functions used in the evaluation into the initial
environment (even though in reality there would be dozens more).</p>
<p>Working through problems like this will very rapidly clarify your
understanding of the environment model.</p>
</section>
<section id="more-on-objects">
<h2>More on objects<a class="headerlink" href="#more-on-objects" title="Permalink to this headline">#</a></h2>
<p>Part B requires that you use a couple of features of OCaml’s object
system that haven’t been needed so far: self references and private
methods. They are described here.
Self-references were also described in class,
as they interact with the environment model
(technically, they enable what is called <em>open recursion</em>).</p>
<section id="self-references">
<h3>Self references<a class="headerlink" href="#self-references" title="Permalink to this headline">#</a></h3>
<p>One common thing to want to do in any object-oriented language
is to be able to call methods in an object from other methods.
Typically there is a dedicated keyword for “the current object”
(usually <code class="docutils literal notranslate"><span class="pre">self</span></code> or <code class="docutils literal notranslate"><span class="pre">this</span></code>), but OCaml has a more flexible solution.
If you need to identify the current object,
you just put its name in parentheses after the keyword <code class="docutils literal notranslate"><span class="pre">object</span></code>.
So instead of writing:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">object</span>
  <span class="c">(* method definitions *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>you write:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="o">(</span><span class="n">self</span><span class="o">)</span>
  <span class="c">(* method definitions *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then you can call methods in the object from within other methods in
the same object using the syntax <code class="docutils literal notranslate"><span class="pre">self#foo</span></code> for a method <code class="docutils literal notranslate"><span class="pre">foo</span></code>.
Note that you don’t have to use the word <code class="docutils literal notranslate"><span class="pre">self</span></code>; you can write:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="o">(</span><span class="n">this</span><span class="o">)</span>
  <span class="c">(* method definitions *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>if you prefer, or even:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="o">(</span><span class="n">fnordly</span><span class="o">)</span>
  <span class="c">(* method definitions *)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>(but if you do the latter, you will annoy your grader!).
We would like you to stick with <code class="docutils literal notranslate"><span class="pre">self</span></code>,
because it’s what everyone else does.</p>
</section>
<section id="private-methods">
<h3>Private methods<a class="headerlink" href="#private-methods" title="Permalink to this headline">#</a></h3>
<p>This feature of OCaml’s OO system wasn’t described in the lectures.</p>
<p>It’s quite common when defining objects to want some methods to be
restricted to the object implementation itself. Self-references allow
the calling of one method in an object from another, but to have private
methods requires that the method definition be marked <code class="docutils literal notranslate"><span class="pre">private</span></code>.
So instead of this:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">method</span> <span class="n">foo</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>you would write:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">method</span> <span class="k">private</span> <span class="n">foo</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>When this is done, the method <code class="docutils literal notranslate"><span class="pre">foo</span></code> can only be called
by other methods in the same class
(unless inheritance is used,
in which case it can also be called by subclasses,
but we haven’t covered inheritance).</p>
</section>
</section>
<section id="modules-and-functors">
<h2>Modules and functors<a class="headerlink" href="#modules-and-functors" title="Permalink to this headline">#</a></h2>
<p>The most common use of modules is implicit: whenever you write code in a
<code class="docutils literal notranslate"><span class="pre">.ml</span></code> file, that file becomes a module (much like in Python). For each
<code class="docutils literal notranslate"><span class="pre">.ml</span></code> file, you typically have a <code class="docutils literal notranslate"><span class="pre">.mli</span></code> file giving the module’s interface
(which includes type signatures for all exported values and functions, <code class="docutils literal notranslate"><span class="pre">type</span></code>
declarations for all exported types, and <code class="docutils literal notranslate"><span class="pre">exception</span></code> declarations for all
exported exceptions defined in the module). As you know, not all functions
defined in a <code class="docutils literal notranslate"><span class="pre">.ml</span></code> file need to be exported; functions that are only used
internally won’t have their signature specified in the <code class="docutils literal notranslate"><span class="pre">.mli</span></code> file.
Similarly, you do not have to specify the implementation of a type in the
<code class="docutils literal notranslate"><span class="pre">.mli</span></code> file, and often it is better to leave it out (which makes the type
<em>abstract</em>, meaning that only the functions in the <code class="docutils literal notranslate"><span class="pre">.ml</span></code> file have access to
its internal structure).</p>
<p>In addition, you can also declare new modules inside of a <code class="docutils literal notranslate"><span class="pre">.ml</span></code> file.
These are effectively “modules within modules”, and they can be exported
(specified in the <code class="docutils literal notranslate"><span class="pre">.mli</span></code> file) or not. The main reason for doing this
is when we generate the modules using <em>functors</em>. A functor (as we
discussed in recitation 4) is a kind of “function on modules” (not a
real OCaml function, but conceptually like a function) by which we mean
a way to take an existing module and create a new module which uses the
existing one. Functor arguments are specified using a <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">type</span></code>,
which is a specification of a particular module (we’ll see examples
below). A very common use case for functors is to create a data
structure from another data structure. For instance, the input module
may represent the concrete type of a component of the data structure
plus some functions on it (for instance, a function to compare values of
that type for orderable types). The functor will take that input module
and use it to create a new module representing a data structure
containing that type.</p>
<p>All this may seem a bit abstract, so let’s look at an example of
functors. Sets are defined in OCaml in the <code class="docutils literal notranslate"><span class="pre">Set</span></code> module, which defines
a functor called <code class="docutils literal notranslate"><span class="pre">Set.Make</span></code>. This takes as its module argument a
module of module type <code class="docutils literal notranslate"><span class="pre">Ordered_type</span></code> which has this signature:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Ordered_type</span> <span class="o">=</span>
  <span class="k">sig</span>
    <span class="k">type</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>This signature (<code class="docutils literal notranslate"><span class="pre">sig</span></code> form in OCaml) says that an ordered type is a
type <code class="docutils literal notranslate"><span class="pre">t</span></code> which also has a comparison function called <code class="docutils literal notranslate"><span class="pre">compare</span></code> which
takes two values of type <code class="docutils literal notranslate"><span class="pre">t</span></code> and returns an <code class="docutils literal notranslate"><span class="pre">int</span></code>: <code class="docutils literal notranslate"><span class="pre">0</span></code> if the two
are “equal”, <code class="docutils literal notranslate"><span class="pre">-1</span></code> if the first is smaller than the second, and <code class="docutils literal notranslate"><span class="pre">1</span></code>
if the first is larger than the second.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In part C, we define our own module type called <code class="docutils literal notranslate"><span class="pre">ORDERED_TYPE</span></code>
which is exactly like the <code class="docutils literal notranslate"><span class="pre">Ordered_type</span></code> module type,
because we want to do everything from scratch to show how it’s done.</p>
</div>
<p>To create a module that matches this signature, we use the <code class="docutils literal notranslate"><span class="pre">struct</span></code> form (no
relation to <code class="docutils literal notranslate"><span class="pre">struct</span></code>s in C/C++!). Here’s an example:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">OrderedString</span> <span class="o">:</span> <span class="nc">Ordered_type</span> <span class="o">=</span>
  <span class="k">struct</span>
    <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">string</span>
    <span class="k">let</span> <span class="n">compare</span> <span class="n">s1</span> <span class="n">s2</span> <span class="o">=</span> <span class="nn">Stdlib</span><span class="p">.</span><span class="n">compare</span> <span class="n">s1</span> <span class="n">s2</span>
      <span class="c">(* or just: let compare = Stdlib.compare *)</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>This creates an <code class="docutils literal notranslate"><span class="pre">OrderedString</span></code> module which contains the <code class="docutils literal notranslate"><span class="pre">string</span></code>
type and a function for string comparison. The <code class="docutils literal notranslate"><span class="pre">compare</span></code> function just
dispatches to the OCaml built-in <code class="docutils literal notranslate"><span class="pre">compare</span></code> function, which is more
specifically called <code class="docutils literal notranslate"><span class="pre">Stdlib.compare</span></code>; the <code class="docutils literal notranslate"><span class="pre">Stdlib</span></code> module is where
all the built-in functions live.</p>
<p>Given this, we can create a set of strings using the <code class="docutils literal notranslate"><span class="pre">Set.Make</span></code>
functor as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">StringSet</span> <span class="o">=</span> <span class="nn">Set</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="nc">OrderedString</span><span class="o">)</span>
</pre></div>
</div>
<p>and now we can make sets of strings!
The documentation on the kind of sets made by this functor is available
<a class="reference external" href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/Set.S.html">here</a>.
Here are some examples:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">let</span> <span class="n">empty</span> <span class="o">=</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">empty</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">empty</span> <span class="o">:</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">add</span> <span class="s2">&quot;foo&quot;</span> <span class="n">empty</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">s1</span> <span class="o">:</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">add</span> <span class="s2">&quot;bar&quot;</span> <span class="n">s1</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">s2</span> <span class="o">:</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">mem</span> <span class="s2">&quot;foo&quot;</span> <span class="n">s2</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">true</span>
<span class="o">#</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">mem</span> <span class="s2">&quot;bar&quot;</span> <span class="n">s2</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">true</span>
<span class="o">#</span> <span class="nn">StringSet</span><span class="p">.</span><span class="n">mem</span> <span class="s2">&quot;baz&quot;</span> <span class="n">s2</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">false</span>
</pre></div>
</div>
<p>Notice that the set type <code class="docutils literal notranslate"><span class="pre">StringSet.t</span></code> is abstract, which means that
once the set has been constructed you can only access it using functions
defined in the module. Creating a set of <code class="docutils literal notranslate"><span class="pre">int</span></code>s would be very
similar: you would define an <code class="docutils literal notranslate"><span class="pre">OrderedInt</span></code> module and pass it to the
<code class="docutils literal notranslate"><span class="pre">Set.Make</span></code> functor to generate an <code class="docutils literal notranslate"><span class="pre">IntSet</span></code> module.</p>
<p>Note that these sets are <em>functional</em>. You cannot change the contents of
an existing set; you have to create a new one with more or fewer
elements. Because of the way that sets are implemented, this can be done
quite efficiently.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To those of you who have worked with Java’s generics or C++’s
templates, this might seem like a very complicated way to generate
sets. Why not just make the set module polymorphic on the set element
type? The problem with this is that the element type is not enough;
we also (at least!) have to specify an equality function between
values of that type (so you can check if a value is in the set or
not), and for efficient functional sets, you need the element type to
be orderable (so you can implement sets using <em>e.g.</em> self-balancing
tree types, which require orderable elements). That’s why the
<code class="docutils literal notranslate"><span class="pre">Set.Make</span></code> functor requires a module argument which contains not
just a type but a function which compares two values of that type for
ordering. In fact, functors are very flexible; the input module (or
modules) can have more than one type, as well as functions which use
all the types. That’s why functors have been characterized as begin
“like C++ templates on steroids”.</p>
</div>
<p>Also, note that modules are <em>not</em> like objects! In particular, <strong>a
module doesn’t store any data</strong>. Instead, functions in modules can
return values of particular types (like sets) which do store data. Since
these types are usually abstract, you can’t do anything with that data
except pass it to other functions in the module, some of which generally
are able to extract components of the data. Thus, modules can do the
same kinds of things that objects do, but they do it in a different way.</p>
<p>Using functors is kind of like riding a bike; at first they seem
intimidatingly abstract and weird, but eventually you come to realize
that they are just a fairly simple mechanism for splitting up the
definition of a module into various reusable parts. Functors are
actually one of the great things about OCaml, and it’s a shame other
programming languages (other than close relatives of OCaml like Standard
ML) don’t have anything similar.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Preamble.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Details</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="partA_environment_model.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Part A: The environment model</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Vanier<br/>
  
      &copy; Copyright 2023, Michael C. Vanier. All rights reserved.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>