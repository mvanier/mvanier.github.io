
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Part C: Modules and functors &#8212; The CS 4 book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Part D: Special topics" href="partD_special_topics.html" />
    <link rel="prev" title="Part B: Imperative objects" href="partB_imperative_objects.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">The CS 4 book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../admin/index.html">
   Administrative information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Syllabus.html">
     Syllabus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Collaboration_policies.html">
     Collaboration policies
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Motivation.html">
   Motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../History.html">
   History
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../0/Assignment0.html">
     Assignment 0: Getting set up
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../1/index.html">
     Assignment 1: Evaluation and recursion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partA_exercises.html">
       Part A: Basic exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partC_recursion.html">
       Part C: Recursion
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../2/index.html">
     Assignment 2: Asymptotic complexity and higher-order functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partA_orders_of_growth.html">
       Part A: Orders of growth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partC_higher_order_functions.html">
       Part C. Higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partD_additional_problems.html">
       Part D: Additional problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../3/index.html">
     Assignment 3: Lists
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partA_lists.html">
       Part A: Working with lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partB_structural_generative_recursion.html">
       Part B: Structural and generative recursion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partC_more_lists.html">
       Part C: Some harder problems with lists
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../4/index.html">
     Assignment 4: Data abstraction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partA_abstraction.html">
       Part A: Abstraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partB_more_abstraction.html">
       Part B: More abstraction problems
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partC_algebra.html">
       Part C: Miniproject: Algebraic expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../midterm/index.html">
     Midterm exam
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partA_complexity.html">
       Part A: Asymptotic time complexity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partB_lists_hofs.html">
       Part B: Recursion and higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partC_data_structures.html">
       Part C: Data structures: AA trees
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../5/index.html">
     Assignment 5: Tags and objects
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partA_mutation.html">
       Part A: Mutation and imperative programming
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partB_tagged_data.html">
       Part B: Tagged Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partC_objects.html">
       Part C: Objects
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Assignment 6: Environmentally-friendly
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Preamble.html">
       Details
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partA_environment_model.html">
       Part A: The environment model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partB_imperative_objects.html">
       Part B: Imperative objects
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Part C: Modules and functors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partD_special_topics.html">
       Part D: Special topics
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../readings/index.html">
   Readings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/ocaml_cheat_sheet.html">
     OCaml syntax cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/subst.html">
     The substitution model
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#priority-queues">
   Priority queues
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#leftist-heaps">
     Leftist heaps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merging-leftist-heaps">
     Merging leftist heaps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#priorityqueue-module">
   1.
   <code class="docutils literal notranslate">
    <span class="pre">
     PriorityQueue
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#makepriorityqueue-functor">
   2.
   <code class="docutils literal notranslate">
    <span class="pre">
     MakePriorityQueue
    </span>
   </code>
   functor
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Part C: Modules and functors</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#priority-queues">
   Priority queues
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#leftist-heaps">
     Leftist heaps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merging-leftist-heaps">
     Merging leftist heaps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#priorityqueue-module">
   1.
   <code class="docutils literal notranslate">
    <span class="pre">
     PriorityQueue
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#makepriorityqueue-functor">
   2.
   <code class="docutils literal notranslate">
    <span class="pre">
     MakePriorityQueue
    </span>
   </code>
   functor
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="part-c-modules-and-functors">
<h1>Part C: Modules and functors<a class="headerlink" href="#part-c-modules-and-functors" title="Permalink to this headline">#</a></h1>
<p>In this section, you will work with OCaml modules and functors by
implementing a data structure called a <em>priority queue</em>. (“Queue” is
pronounced “kyoo”.) The specific implementation you will create is
called a <em>leftist heap</em>. So let’s talk about these things now.</p>
<section id="priority-queues">
<h2>Priority queues<a class="headerlink" href="#priority-queues" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a priority queue implementation given in the OCaml manual as
part of the module documentation. Please don’t consult that for this
assignment (the implementations are different anyway).</p>
</div>
<p>A priority queue is a data structure that is ordered so that it provides
fast access to its minimum element, as defined by some ordering
relationship. Conceptually, you can think of that element as “the next
thing to be processed”. It also has to have an operation which deletes
the minimum element and returns another priority queue (which would be
useful after processing that element), as well as several other
operations, which are summarized here as an OCaml module type:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">PRIORITY_QUEUE</span> <span class="o">=</span>
  <span class="k">sig</span>
    <span class="k">exception</span> <span class="nc">Empty</span>

    <span class="k">type</span> <span class="n">elem</span>      <span class="c">(* Abstract type of elements of queue. *)</span>
    <span class="k">type</span> <span class="n">t</span>         <span class="c">(* Abstract type of queue. *)</span>

    <span class="k">val</span> <span class="n">empty</span>      <span class="o">:</span> <span class="n">t</span>                <span class="c">(* The empty queue.         *)</span>
    <span class="k">val</span> <span class="n">is_empty</span>   <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>        <span class="c">(* Check if queue is empty. *)</span>
    <span class="k">val</span> <span class="n">insert</span>     <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">elem</span> <span class="o">-&gt;</span> <span class="n">t</span>   <span class="c">(* Insert item into queue.  *)</span>
    <span class="k">val</span> <span class="n">find_min</span>   <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">elem</span>        <span class="c">(* Return minimum element.  *)</span>
    <span class="k">val</span> <span class="n">delete_min</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span>           <span class="c">(* Delete minimum element.  *)</span>
    <span class="k">val</span> <span class="n">from_list</span>  <span class="o">:</span> <span class="n">elem</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="n">t</span>   <span class="c">(* Convert list to queue.   *)</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>Of these operations, note that the operation <code class="docutils literal notranslate"><span class="pre">from_list</span></code> is not
fundamental to the definition of a priority queue, but it’s useful.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When we refer to “queue” in this section, we always mean a priority queue,
not a first-in/first-out data structure which is the usual meaning
of the word “queue” in programming.  So here,
“queue” is just short for “priority queue”.</p>
</div>
<p>Also note that we are being loose about the words “insert” and “delete”.
These operations are purely functional, so that when we say we “insert”
an element into a queue, we really mean that we create a new queue which
has the extra element in it; the original queue is unchanged. Similarly,
when we “delete” an element from a queue, we really mean that we create
a new queue without the offending element; the original queue is once
again unchanged.</p>
<section id="leftist-heaps">
<h3>Leftist heaps<a class="headerlink" href="#leftist-heaps" title="Permalink to this headline">#</a></h3>
<p>Now that we know how our data structure is supposed to behave, the next
question is: how do we implement it? Naturally, there are lots of
choices, each of which will have different trade-offs. In this section
you’re going to implement priority queues as <em>leftist heaps</em>. This is a
data structure that has the following attributes:</p>
<ul>
<li><p>It can either be a leaf (representing an empty heap) or a node which
contains:</p>
<ul>
<li><p>a stored element</p></li>
<li><p>a non-negative integer value called its “rank”</p></li>
<li><p>a left and right subheap, each of which is also a leftist heap</p>
<p>Thus, a leftist heap is a binary tree with additional rank
information stored in the nodes. The tree will in general <strong>not</strong>
be balanced; it will usually have more elements in the left
subtree than in the right. We say that the tree “skews to the
left”.</p>
</li>
</ul>
</li>
<li><p>The element stored at the top of the tree is smaller (more precisely,
is no larger) than any of the elements stored beneath it in either
subtree.</p></li>
<li><p>As mentioned, each node has an integer value associated with it,
which is called its <em>rank</em>. The rank of a node is equal to the length
of its <em>right spine</em>, which is the number of nodes in the rightmost
path from the node in question to an empty (leaf) node (this will
also turn out to be the shortest path to a leaf node). Thus, a leaf
node has rank 0, and a heap with a right subheap which is a leaf has
rank 1. However, ranks are only stored in nodes, not in leaves.
Having the rank stored in the nodes makes many operations much
faster.</p></li>
<li><p>The rank of any left child is required to be at least as large as the
rank of its right sibling. This is why it’s called a “leftist” heap.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be aware that a heap is <em>not</em> an ordered binary tree in the usual
sense. In other words, it is <em>not</em> necessarily the case that all the
elements in the left subheap are smaller than those in the right
subheap. The only requirement is that an element in a node is smaller
than elements in the left <em>and</em> right subheaps of that node.</p>
</div>
<p>The interesting feature of leftist heaps is that they support very
efficient merging of two heaps to form a combined heap. (Of course,
since we’re using purely functional code, you don’t alter the original
heaps.) Leftist heaps can be merged in <span class="math notranslate nohighlight">\(\Theta(log\ N)\)</span> time,
where <span class="math notranslate nohighlight">\(N\)</span> is the total number of elements in the resulting heap.</p>
<p>Furthermore, once the merge operation
(which, you’ll note, is not a required operation for priority queues)
is implemented, you can easily define most of the rest
of the heap operations in terms of it. Specifically, you can define the
<code class="docutils literal notranslate"><span class="pre">insert</span></code> and <code class="docutils literal notranslate"><span class="pre">delete_min</span></code> operations in terms of merging, and the
other operations are then trivial to define, except for the list-to-heap
conversion routine.
That can be done easily in <span class="math notranslate nohighlight">\(\Theta(N\ log(N))\)</span> time,
and with more difficulty in <span class="math notranslate nohighlight">\(\Theta(N)\)</span> time.
(You’re not required to find the most efficient solution,
but it’s a good exercise.)</p>
</section>
<section id="merging-leftist-heaps">
<h3>Merging leftist heaps<a class="headerlink" href="#merging-leftist-heaps" title="Permalink to this headline">#</a></h3>
<p>OK, so now we need to figure out how to merge two leftist heaps to
create a new leftist heap. The basic algorithm is quite simple:</p>
<ul class="simple">
<li><p>If either heap is empty, return the other heap.</p></li>
<li><p>If the first heap’s minimum element is smaller than the second heap’s
minimum element, make a new heap from the first heap’s minimum
element, the first heap’s left subheap, and the result of merging the
first heap’s right subheap with the second heap.</p></li>
<li><p>Otherwise, make a new heap from the second heap’s minimum element,
the second heap’s left subheap, and the result of merging the first
heap with the second heap’s right subheap.</p></li>
</ul>
<p>Here is how to make a new heap from a minimum element and two heaps: the
resulting heap must have:</p>
<ul class="simple">
<li><p>the given minimum element</p></li>
<li><p>a rank which is the smaller of the ranks of the original heaps, plus 1</p></li>
<li><p>a left subheap which is the original heap with the larger rank</p></li>
<li><p>a right subheap which is the original heap with the smaller rank</p></li>
</ul>
<p>This algorithm will preserve the leftist heap property in the merged
heap.</p>
<p>Here are the problems.</p>
</section>
</section>
<section id="priorityqueue-module">
<h2>1. <code class="docutils literal notranslate"><span class="pre">PriorityQueue</span></code> module<a class="headerlink" href="#priorityqueue-module" title="Permalink to this headline">#</a></h2>
<p>[<strong>6</strong>]  (60 minutes)</p>
<p>Write a module <code class="docutils literal notranslate"><span class="pre">PriorityQueue</span></code> which implements the <code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code>
module type. Assume that the <code class="docutils literal notranslate"><span class="pre">elem</span></code> type will be <code class="docutils literal notranslate"><span class="pre">int</span></code>. Here is a
template for your code:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">PriorityQueue</span> <span class="o">:</span> <span class="o">(</span><span class="nc">PRIORITY_QUEUE</span> <span class="k">with</span> <span class="k">type</span> <span class="n">elem</span> <span class="o">=</span> <span class="kt">int</span><span class="o">)</span> <span class="o">=</span>
  <span class="k">struct</span>
    <span class="k">exception</span> <span class="nc">Empty</span>

    <span class="k">type</span> <span class="n">elem</span> <span class="o">=</span> <span class="kt">int</span>

    <span class="c">(*</span>
<span class="c">     * Data type: either</span>
<span class="c">     * -- a Leaf, or</span>
<span class="c">     * -- a Node of (rank, item, left heap, right heap).</span>
<span class="c">     *)</span>
    <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Leaf</span> <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">elem</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>

    <span class="c">(* Your code goes here. *)</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>You will need to fill in the definitions for all the module functions
(the functions whose signatures are in the <code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code> module
type). You can also write additional unexported helper functions in the
module, if that will make things easier. Make sure you raise the
<code class="docutils literal notranslate"><span class="pre">Empty</span></code> exception when trying to do invalid things <em>e.g.</em> finding the
minimum value in an empty queue. Don’t change the <code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code>
module type!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Based on the discussion given above, one unexported helper function
you will definitely want to implement is the <code class="docutils literal notranslate"><span class="pre">merge</span></code> function.</p>
</div>
<p>Note that since the type <code class="docutils literal notranslate"><span class="pre">elem</span></code> is abstract, if you want to use a real
type as the elements of your priority queue (and it would be pretty
useless otherwise), you have to specify which type you want the
<code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code>’s <code class="docutils literal notranslate"><span class="pre">elem</span></code> value to represent. (This is fairly clunky
syntax.) Also, you might ask why you can’t just make it parametric, like
a type <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">list</span></code>. You actually can in some cases, but here we need a
type with an ordering relation, and there is no way to guarantee that
any arbitrary type will (a) be orderable at all — what if it’s a
function type? or (b) will be orderable using the same function (<em>e.g.</em>
the built-in <code class="docutils literal notranslate"><span class="pre">compare</span></code> function). So it’s better to write the code as
it’s written above. Also, this will make it easy to transform into a
functor (see below).</p>
<p>Here’s an interesting point to ponder: why don’t we also have to specify
what the abstract priority queue <code class="docutils literal notranslate"><span class="pre">t</span></code> type represents in the code
above? (You don’t have to write down the answer in your code, but if you
can’t figure this out, ask your TA.)</p>
<p>Use the built-in (overloaded) comparison function <code class="docutils literal notranslate"><span class="pre">compare</span></code> and/or the
overloaded comparison operators (<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> <em>etc.</em>) to do whatever
comparisons may need to be done. This works because OCaml’s comparison
operators work on any type. (We’ll see a more elegant way to do this
below.)</p>
<p>Use your priority queue implementation to write a <em>heap sort</em> function
called <code class="docutils literal notranslate"><span class="pre">heap_sort</span></code>. This will take a list of <code class="docutils literal notranslate"><span class="pre">int</span></code>s as its
argument and will</p>
<ul class="simple">
<li><p>first convert the list to a priority queue (implemented as a leftist
heap) using the <code class="docutils literal notranslate"><span class="pre">from_list</span></code> function of the module</p></li>
<li><p>successively remove the smallest element from the heap and “cons” it
onto (<em>i.e.</em> place it onto the front of) a list until there are no more
items in the heap</p></li>
<li><p>reverse the list to get a sorted list in ascending order</p></li>
</ul>
<p>This function should be defined <em>outside</em> of the <code class="docutils literal notranslate"><span class="pre">PriorityQueue</span></code> module,
which means that the only functions from that module you can use are the
exported ones (those whose signatures are in the <code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code> module
type).</p>
</section>
<section id="makepriorityqueue-functor">
<h2>2. <code class="docutils literal notranslate"><span class="pre">MakePriorityQueue</span></code> functor<a class="headerlink" href="#makepriorityqueue-functor" title="Permalink to this headline">#</a></h2>
<p>[<strong>4</strong>]  (30 minutes)</p>
<p>As written, the code is dependent on the built-in comparison functions.
To make this more generic, let’s define some types and module types:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(* Signature for ordered objects. *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">ORDERED_TYPE</span> <span class="o">=</span>
  <span class="k">sig</span>
    <span class="k">type</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
  <span class="k">end</span>

<span class="c">(* Signature for priority queues. *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">PRIORITY_QUEUE</span> <span class="o">=</span>
  <span class="k">sig</span>
    <span class="k">exception</span> <span class="nc">Empty</span>

    <span class="k">type</span> <span class="n">elem</span>
    <span class="k">type</span> <span class="n">t</span>

    <span class="k">val</span> <span class="n">empty</span>      <span class="o">:</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">is_empty</span>   <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
    <span class="k">val</span> <span class="n">insert</span>     <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">elem</span> <span class="o">-&gt;</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">find_min</span>   <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">elem</span>
    <span class="k">val</span> <span class="n">delete_min</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">from_list</span>  <span class="o">:</span> <span class="n">elem</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="n">t</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>What you have to do now is generalize your priority queue implementation
into a functor that takes a module implementing the <code class="docutils literal notranslate"><span class="pre">ORDERED</span></code> module
type as its argument, and produces a priority queue (implemented using a
leftist heap) which is specialized for that particular type of data. For
instance, you can define a module of ordered strings like this:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">OrderedString</span> <span class="o">=</span>
  <span class="k">struct</span>
    <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">string</span>
    <span class="k">let</span> <span class="n">compare</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>and then define your string priority queue like this:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">StringPQ</span> <span class="o">=</span> <span class="nc">MakePriorityQueue</span><span class="o">(</span><span class="nc">OrderedString</span><span class="o">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">MakePriorityQueue</span></code> is in fact a functor. It takes an input
module (in this case, <code class="docutils literal notranslate"><span class="pre">OrderedString</span></code>), and returns an output module
(in this case <code class="docutils literal notranslate"><span class="pre">StringPQ</span></code>) which is a priority queue specialized to
work only on strings.</p>
<p>Once you’ve done this, redefine your heap sort function (again, outside
of the <code class="docutils literal notranslate"><span class="pre">StringPQ</span></code> module) using a <code class="docutils literal notranslate"><span class="pre">StringPQ</span></code> as the heap. Call the
new function <code class="docutils literal notranslate"><span class="pre">heap_sort_2</span></code>. Note that this heap sort will only work on
strings.</p>
<p>To get you started, here is a skeleton of the code you should use for
the functor definition:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">MakePriorityQueue</span> <span class="o">(</span><span class="nc">Elt</span> <span class="o">:</span> <span class="nc">ORDERED</span><span class="o">)</span>
  <span class="o">:</span> <span class="o">(</span><span class="nc">PRIORITY_QUEUE</span> <span class="k">with</span> <span class="k">type</span> <span class="n">elem</span> <span class="o">=</span> <span class="nn">Elt</span><span class="p">.</span><span class="n">t</span><span class="o">)</span> <span class="o">=</span>
  <span class="k">struct</span>
    <span class="c">(* Your code goes here... *)</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>Note that again you have to specify what the type <code class="docutils literal notranslate"><span class="pre">elem</span></code> in the
<code class="docutils literal notranslate"><span class="pre">PRIORITY_QUEUE</span></code> represents. Here, it better be the same type as the
type <code class="docutils literal notranslate"><span class="pre">t</span></code> in the <code class="docutils literal notranslate"><span class="pre">ORDERED</span></code> argument (which we have called <code class="docutils literal notranslate"><span class="pre">Elt</span></code>).</p>
<p>This code will be nearly identical to the code above. All you are really
doing is repackaging that code into a functor.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="partB_imperative_objects.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Part B: Imperative objects</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="partD_special_topics.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Part D: Special topics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Vanier<br/>
  
      &copy; Copyright 2023, Michael C. Vanier. All rights reserved.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>