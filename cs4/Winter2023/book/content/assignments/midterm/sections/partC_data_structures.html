
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Part C: Data structures: AA trees &#8212; The CS 4 book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Readings" href="../../../readings/index.html" />
    <link rel="prev" title="Part B: Recursion and higher-order functions" href="partB_lists_hofs.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">The CS 4 book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../admin/index.html">
   Administrative information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Syllabus.html">
     Syllabus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Collaboration_policies.html">
     Collaboration policies
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Motivation.html">
   Motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../History.html">
   History
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../0/Assignment0.html">
     Assignment 0: Getting set up
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../1/index.html">
     Assignment 1: Evaluation and recursion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partA_exercises.html">
       Part A: Basic exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partC_recursion.html">
       Part C: Recursion
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../2/index.html">
     Assignment 2: Asymptotic complexity and higher-order functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partA_orders_of_growth.html">
       Part A: Orders of growth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partC_higher_order_functions.html">
       Part C. Higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partD_additional_problems.html">
       Part D: Additional problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../3/index.html">
     Assignment 3: Lists
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partA_lists.html">
       Part A: Working with lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partB_structural_generative_recursion.html">
       Part B: Structural and generative recursion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partC_more_lists.html">
       Part C: Some harder problems with lists
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../4/index.html">
     Assignment 4: Data abstraction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partA_abstraction.html">
       Part A: Abstraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partB_more_abstraction.html">
       Part B: More abstraction problems
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../4/sections/partC_algebra.html">
       Part C: Miniproject: Algebraic expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Midterm exam
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partA_complexity.html">
       Part A: Asymptotic time complexity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partB_lists_hofs.html">
       Part B: Recursion and higher-order functions
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Part C: Data structures: AA trees
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../readings/index.html">
   Readings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/ocaml_cheat_sheet.html">
     OCaml syntax cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/subst.html">
     The substitution model
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-information">
   Background information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tree-rotations">
   Tree rotations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inserting-into-an-aa-tree">
   Inserting into an AA tree
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ocaml-implementation">
   OCaml implementation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#member">
     1.
     <code class="docutils literal notranslate">
      <span class="pre">
       member
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skew-and-split">
     2.
     <code class="docutils literal notranslate">
      <span class="pre">
       skew
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       split
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Examples
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#insert">
     3.
     <code class="docutils literal notranslate">
      <span class="pre">
       insert
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Examples
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing">
   Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-your-trees">
   Visualizing your trees
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Part C: Data structures: AA trees</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-information">
   Background information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tree-rotations">
   Tree rotations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inserting-into-an-aa-tree">
   Inserting into an AA tree
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ocaml-implementation">
   OCaml implementation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#member">
     1.
     <code class="docutils literal notranslate">
      <span class="pre">
       member
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skew-and-split">
     2.
     <code class="docutils literal notranslate">
      <span class="pre">
       skew
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       split
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Examples
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#insert">
     3.
     <code class="docutils literal notranslate">
      <span class="pre">
       insert
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Examples
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing">
   Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-your-trees">
   Visualizing your trees
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="part-c-data-structures-aa-trees">
<h1>Part C: Data structures: AA trees<a class="headerlink" href="#part-c-data-structures-aa-trees" title="Permalink to this headline">#</a></h1>
<p>In this section you’ll be implementing a nontrivial data structure. This
section is worth 8 marks in all.</p>
<section id="background-information">
<h2>Background information<a class="headerlink" href="#background-information" title="Permalink to this headline">#</a></h2>
<p>In this section, we are going to implement a non-trivial data structure
called an “AA tree”. The name “AA” comes from the inventor of the data
structure, the Swedish computer scientist Arne Andersson. AA trees are
an example of a “self-balancing binary search tree”. It is a
comparatively recent invention; the first paper describing it came out
in 1993. It is one of a fairly large family of self-balancing binary
search trees; other data structures in this family include red-black
trees, AVL trees, 2-3 trees, 2-3-4 trees, B-trees <em>etc.</em> AA trees are
interesting because they are among the simplest to implement and yet
still perform well.</p>
<p>Before we get into the details of this data structure, let’s explain why
such a thing is desirable. Many practical applications of interest
require set-like or map-like collections of values which have (at
least!) the following requirements:</p>
<ul class="simple">
<li><p>You have to be able to find a particular value in the collection as
quickly as possible (or report that it isn’t there).</p></li>
<li><p>You have to be able to add a new value to the collection as quickly
as possible.</p></li>
<li><p>The collection mustn’t duplicate the values searched over.</p></li>
</ul>
<p>The difference between a set and a map is that sets are just the values
in the collection, while maps have an associated value for each “key”
value in the map. Our AA trees will implement sets of integers, which is
about as simple as it gets.</p>
<p>If we didn’t care about efficiency, we can easily implement a set of
integers using a list of integers. To find whether a particular integer
is in the set, we just have to search through the list. This is an
<span class="math notranslate nohighlight">\(O(N)\)</span> operation, where <span class="math notranslate nohighlight">\(N\)</span> is the length of the list, so
it’s rather slow. To add a value to the list (making sure there are no
duplicates), we can just search for the value in the list; if it’s
found, there is no need to add it, and if not, we can add it to the
front of the list. This is also <span class="math notranslate nohighlight">\(O(N)\)</span>. (If we don’t mind repeated
elements, we can just add it to the front of the list without searching,
which is <span class="math notranslate nohighlight">\(O(1)\)</span>.)</p>
<p>Somewhere along the line, someone realized that if we arranged the data
in a binary tree-like data structure, we can potentially get much faster
searches (<span class="math notranslate nohighlight">\(O(log\ N)\)</span> instead of <span class="math notranslate nohighlight">\(O(N)\)</span>) and also get
<span class="math notranslate nohighlight">\(O(log\ N)\)</span> insertions. To do this, we create nodes containing
three things: a data value, a left subtree, and a right subtree. A
subtree can be a leaf (no data) or another node. In OCaml, such a data
structure would look like this:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(* Assume we are storing only integers in the tree. *)</span>
<span class="k">type</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Leaf</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">tree</span> <span class="o">*</span> <span class="n">tree</span>   <span class="c">(* data value, left subtree, right subtree *)</span>
</pre></div>
</div>
<p>We further stipulate that all the elements in the left subtree of a node
are strictly less than the value at the node, and all the elements in
the right subtree are strictly greater than the value at the node (this
makes the tree an <em>ordered binary tree</em>). Clearly, this will only work
if the values stored in the tree are orderable (like integers).</p>
<p>Searching through a tree like this is easy (you’ll write the code
below). Insertion is also easy: you simply walk down the tree until you
reach a leaf where the new value ought to go, and then replace the leaf
with a node whose two subtrees are leaves. If the tree is roughly
balanced (the left and right subtrees of all nodes are about the same
size), then looking up a value in the tree or inserting a value into the
tree is <span class="math notranslate nohighlight">\(O(log\ N)\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the number of values stored
in the tree. That’s because on average, going to a left or right subtree
of a node gets rid of about half of the values in the tree, and after
roughly <span class="math notranslate nohighlight">\(log_2 N\)</span> divisions by two you will end up at a leaf.</p>
<p>Unfortunately, if you add elements to the tree naively, you can easily
end up with an unbalanced tree, where some branches of the tree are
empty and others have large numbers of nodes. In the worst case, the
tree will only have nodes on one side (left or right) and then it’s no
better than a linked list. There needs to be some way to make sure that
the tree stays balanced when you add new values to it. If you can
guarantee that the tree stays balanced, you can guarantee that searching
for values in the tree and adding new values to the tree are
<span class="math notranslate nohighlight">\(O(log\ N)\)</span> operations, which is acceptably fast for many
applications.</p>
<p>Self-balancing binary trees generally have additional data in each node
which helps in the balancing operation. In the case of AA trees, this
data is called a <em>level</em> and is an integer &gt;= 0. Leaves have a level of
zero (this does not need to be stored explicitly in the tree), while
nodes have levels &gt; 0. The way that levels are assigned to nodes will be
described below.</p>
<p>Some terminology we’ll use:</p>
<ul class="simple">
<li><p>The <em>root node</em> of a tree is the topmost node of the tree.</p></li>
<li><p>The <em>level of a tree</em> is the level of the root node of the tree.</p></li>
<li><p>A <em>child node</em> of a node is the root node of one of its subtrees.</p></li>
<li><p>A <em>parent node</em> of a node is the node which has the original node as
one of its child nodes. Note that root nodes have no parent node.</p></li>
<li><p>A <em>grandparent node</em> is the parent node of a node’s parent node.</p></li>
<li><p><em>Naively adding</em> a value to a tree is adding a node containing the
value to the tree without worrying about whether the tree becomes
unbalanced or not.</p></li>
</ul>
<p>For the purposes of these terms, a leaf is considered a kind of node.</p>
<p>Here is the definition of the AA tree datatype we will use. This tree
can only store integers.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Leaf</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">tree</span> <span class="o">*</span> <span class="n">tree</span>   <span class="c">(* level, value, left/right subtrees *)</span>
</pre></div>
</div>
<p>This is the same as the definition of <code class="docutils literal notranslate"><span class="pre">tree</span></code> given above, except that
there is an extra <code class="docutils literal notranslate"><span class="pre">int</span></code> value stored at each node representing the
level of the node. Note that the first <code class="docutils literal notranslate"><span class="pre">int</span></code> value in the node is the
level and the second one is the integer value being stored at the node.
After that comes the left and right subtrees of the node, which can be
<code class="docutils literal notranslate"><span class="pre">Leaf</span></code> nodes or not.</p>
<p>An AA tree must satisfy the following invariants:</p>
<ul class="simple">
<li><p>A node’s value must be strictly larger than any value stored in its
left subtree and strictly smaller than any value stored in its right
subtree. (This is the order invariant.)</p></li>
<li><p>The data values stored in the tree must contain no duplicates.</p></li>
<li><p>The level of a <code class="docutils literal notranslate"><span class="pre">Leaf</span></code> is zero.</p></li>
<li><p>The level of a <code class="docutils literal notranslate"><span class="pre">Node</span></code> must be either the same as that of its right
subtree or one greater. If it is the same, the link between the node
and its parent is called a “horizontal link”.</p></li>
<li><p>The level of a <code class="docutils literal notranslate"><span class="pre">Node</span></code> must be exactly one greater than the level of
its left subtree. In other words, you can’t have a horizontal link
from a node to its left subtree.</p></li>
<li><p>The level of a <code class="docutils literal notranslate"><span class="pre">Node</span></code> must be strictly less than that of its
grandparent. In other words, you can’t have a node with a right child
whose level is the same which also has a right child whose level is
the same. Put differently, you can’t have two consecutive horizontal
links. (This is obvious for the left child of a node, since you can’t
have horizontal links at all on left children.)</p></li>
</ul>
<p>Also, when a value is added to a tree, it is added as a node of level 1
whose subtrees are both leaves.</p>
<p>Note that some of these invariants can (and will) be violated
temporarily while inserting new values into an AA tree, but then the
tree must be readjusted so that the invariants again apply.</p>
<p>The AA trees we will be working with are purely functional, so (for
instance) inserting an integer into a tree will yield a new tree instead
of changing the old one.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h2>
<p>Let’s look at some AA trees. We’ll add some integers between 1 and 100
to an empty AA tree and see what the resulting trees look like. In some
cases, adding a number to a tree in a “naive” way would result in an
unbalanced tree (which is not a valid AA tree); in that case, after
adding the node we will have to rebalance the tree to preserve the
invariants. We will look at the tree before and after rebalancing, so
you can get an idea of what the balancing operations do before we
describe the code you will need to write. All horizontal links will be
drawn using large red arrows to make them stand out.</p>
<img alt="example 0a" src="../../../../_images/example_0a.png" />
<p>This is a leaf node (which is also an empty tree). It doesn’t store any
data. It has depth 0. There’s not much else to say about it.</p>
<img alt="example 1a" src="../../../../_images/example_1a.png" />
<p>Adding the number <code class="docutils literal notranslate"><span class="pre">50</span></code> creates a node whose two subtrees are both
leaves. The <code class="docutils literal notranslate"><span class="pre">50</span></code> is the value stored in the node. The <code class="docutils literal notranslate"><span class="pre">(L1)</span></code> says
that this node has level 1. This has to be the case because its left
subtree is a leaf, which has level 0, and the level of a node is always
exactly one higher than the level of its left subtree (invariant #5).</p>
<img alt="example 2a" src="../../../../_images/example_2a.png" />
<p>Adding the number <code class="docutils literal notranslate"><span class="pre">40</span></code> creates a new node on the left subtree of the
node containing <code class="docutils literal notranslate"><span class="pre">50</span></code>. The new node has level 1 (as all new nodes must
have), which makes it a left horizontal link. Invariant #5 states that
this is forbidden, so we have to rebalance the tree.</p>
<img alt="example 2b" src="../../../../_images/example_2b.png" />
<p>We rebalance the tree by making the right child of the <code class="docutils literal notranslate"><span class="pre">40</span></code> node the
left child of the <code class="docutils literal notranslate"><span class="pre">50</span></code> node and making the <code class="docutils literal notranslate"><span class="pre">50</span></code> node the right child
of the <code class="docutils literal notranslate"><span class="pre">40</span></code> node. This kind of rebalancing, which turns a left
horizontal link into a right horizontal link, is called a “skew”. It is
one of the two rebalancing operations in an AA tree. These kind of
operations are usually referred to as “tree rotations” in the
literature. (Note that most self-balancing trees have many more kinds of
rotations than AA trees do, which is why AA trees are interesting.)</p>
<img alt="example 3a" src="../../../../_images/example_3a.png" />
<p>This image shows what happens when we naively add the number <code class="docutils literal notranslate"><span class="pre">30</span></code> to
the tree. It has to go to the left of the <code class="docutils literal notranslate"><span class="pre">40</span></code> node in order to
maintain the order invariant, but now the tree is unbalanced because the
<code class="docutils literal notranslate"><span class="pre">40</span></code> node has a left horizontal link. We need to rebalance the tree by
doing another skew operation.</p>
<img alt="example 3b" src="../../../../_images/example_3b.png" />
<p>This is what happens after we have rebalanced the tree. We have made the
right subtree of the <code class="docutils literal notranslate"><span class="pre">30</span></code> node the left subtree of the <code class="docutils literal notranslate"><span class="pre">40</span></code> node,
and we’ve made the <code class="docutils literal notranslate"><span class="pre">40</span></code> node the right subtree of the <code class="docutils literal notranslate"><span class="pre">30</span></code> node.
This, like all skew operations, turns a left horizontal link into a
right one.</p>
<p>However, we’re not out of the woods just yet. Now we have two
consecutive right horizontal links coming off of the <code class="docutils literal notranslate"><span class="pre">30</span></code> node, which
violates invariant #6. We need to do another rebalancing operation.</p>
<img alt="example 3c" src="../../../../_images/example_3c.png" />
<p>Here is the result of the other rebalancing operation. This operation is
called a “split”. The <code class="docutils literal notranslate"><span class="pre">40</span></code> node is raised to level 2, its left subtree
is given back to the <code class="docutils literal notranslate"><span class="pre">30</span></code> node as the right subtree of the <code class="docutils literal notranslate"><span class="pre">30</span></code>
node, and the <code class="docutils literal notranslate"><span class="pre">30</span></code> node is once again made into the left subtree of
the <code class="docutils literal notranslate"><span class="pre">40</span></code> node. Now the tree is balanced again.</p>
<p>You might wonder why we didn’t just take the tree two pictures ago (with
the <code class="docutils literal notranslate"><span class="pre">30</span></code> node as the left subtree of the <code class="docutils literal notranslate"><span class="pre">40</span></code> node and the <code class="docutils literal notranslate"><span class="pre">50</span></code>
node as the right subtree) and just incremented the level of the <code class="docutils literal notranslate"><span class="pre">40</span></code>
tree. In fact, we could do that; this would be another balancing
operation. However, the point of AA trees is to be as simple to
implement as possible, and this would complicate the implementation.
Plus, the new operation is nothing more than the composition of a skew
and a split.</p>
<img alt="example 4a" src="../../../../_images/example_4a.png" />
<p>Now we want to add the number <code class="docutils literal notranslate"><span class="pre">33</span></code> to the tree. This time, we get
lucky. Naively adding the node yield a tree which doesn’t violate any of
the AA tree invariants, so we don’t have to do any rebalancing.</p>
<img alt="example 5a" src="../../../../_images/example_5a.png" />
<p>Now we add <code class="docutils literal notranslate"><span class="pre">36</span></code> to the tree, which gives us two consecutive right
horizontal links. This means we need to do a split.</p>
<img alt="example 5b" src="../../../../_images/example_5b.png" />
<p>When we do a split, we see that now there is a left horizontal link from
the <code class="docutils literal notranslate"><span class="pre">40</span></code> node, so we need to do a skew at that node.</p>
<img alt="example 5c" src="../../../../_images/example_5c.png" />
<p>And there we go! Now our tree is balanced.</p>
<img alt="example 6a" src="../../../../_images/example_6a.png" />
<p>Now we add the number <code class="docutils literal notranslate"><span class="pre">60</span></code> to the tree. Again we get lucky; the
resulting tree doesn’t need rebalancing.</p>
<img alt="example 7a" src="../../../../_images/example_7a.png" />
<p>Now we add the number <code class="docutils literal notranslate"><span class="pre">70</span></code> to the tree. This results in two
consecutive right horizontal links. Therefore, we need to do a split.</p>
<img alt="example 7b" src="../../../../_images/example_7b.png" />
<p>After the split, we now have two consecutive right horizontal links in a
different location (coming off the <code class="docutils literal notranslate"><span class="pre">33</span></code> node). We need to do another
split.</p>
<img alt="example 7c" src="../../../../_images/example_7c.png" />
<p>And there you go, another balanced tree. Easy peasy.</p>
<img alt="example 8a" src="../../../../_images/example_8a.png" />
<p>Let’s add the number <code class="docutils literal notranslate"><span class="pre">65</span></code> to the tree. This gives a left horizontal
link. From what we’ve discussed already, you should realize that this
means we need to do a skew operation.</p>
<img alt="example 8b" src="../../../../_images/example_8b.png" />
<p>After the skew, the tree is again balanced.</p>
<img alt="example 9a" src="../../../../_images/example_9a.png" />
<p>Now we add the number <code class="docutils literal notranslate"><span class="pre">62</span></code> to the tree, which creates a left
horizontal link. That means (you guessed it) we need to rebalance the
tree by doing a skew operation.</p>
<img alt="example 9b" src="../../../../_images/example_9b.png" />
<p>Doing the skew gives two right horizontal links, so now we need to do a
split. Incidentally, this is why we always do skews before splits; a
skew can give rise to a tree with the same nodes which needs to be
split.</p>
<img alt="example 9c" src="../../../../_images/example_9c.png" />
<p>After the split, the tree is balanced.</p>
<img alt="example 10a" src="../../../../_images/example_10a.png" />
<p>Finally, we add <code class="docutils literal notranslate"><span class="pre">64</span></code>, which doesn’t require any rebalancing.</p>
<p>This concludes the AA tree examples. We hope you now have a clearer idea
of how AA trees work and how they stay balanced.</p>
</section>
<section id="tree-rotations">
<h2>Tree rotations<a class="headerlink" href="#tree-rotations" title="Permalink to this headline">#</a></h2>
<p>In the examples given above, we’ve seen that there are a number of
balancing operations or “rotations” that are done to make an unbalanced
tree balanced. Be aware that we don’t require that the tree be exactly
100% balanced. In the case of AA trees, the longest path from the root
node to a leaf is guaranteed to be no more than twice the length of the
shortest path, which preserves the <span class="math notranslate nohighlight">\(O(log\ N)\)</span> lookup and insert
properties we want. What the rotations do is rebalance a tree while
preserving the order invariant. What kind of rotation you do depends on
the way in which the tree is unbalanced. We’ve seen that AA trees have
two different kinds of rotations:</p>
<ul class="simple">
<li><p>skew: changes a left horizontal link to a right horizontal link</p></li>
<li><p>split: fixes the case of two consecutive right horizontal links</p></li>
</ul>
<p>When you do these rotations in the appropriate circumstances, the tree
will become balanced and the order invariant will be preserved.</p>
<p>Here is what a skew looks like. Starting from this:</p>
<img alt="skew1" src="../../../../_images/skew1.png" />
<p>We go to this:</p>
<img alt="skew2" src="../../../../_images/skew2.png" />
<p>In this diagram, the <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> nodes have levels one more than the
<code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code> and <code class="docutils literal notranslate"><span class="pre">Z</span></code> nodes in both cases. However, this will not
always be the case. The skew operation only cares that there is a left
horizontal link between <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>. It changes the left horizontal
link to a right horizontal link as shown and moves the subtrees around
as shown. The skew operation doesn’t change the levels of any nodes.</p>
<p>Notice that the arrow (horizontal link) from the <code class="docutils literal notranslate"><span class="pre">A</span></code> to the <code class="docutils literal notranslate"><span class="pre">B</span></code> node
changes direction and the right child of <code class="docutils literal notranslate"><span class="pre">A</span></code> becomes the left child of
<code class="docutils literal notranslate"><span class="pre">B</span></code>. <code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code>, and <code class="docutils literal notranslate"><span class="pre">Z</span></code> are assumed to be arbitrary balanced
trees.</p>
<p>The other rotation is a split. Starting from this:</p>
<img alt="split1" src="../../../../_images/split1.png" />
<p>We go to this:</p>
<img alt="split2" src="../../../../_images/split2.png" />
<p>Initially, the <code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">Z</span></code> nodes have a level one greater
than the <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> nodes (but you don’t have to check for this).
After the split, the only node whose level changes is the <code class="docutils literal notranslate"><span class="pre">B</span></code> node,
whose level goes up by 1. Notice that this gets rid of the horizontal
links.</p>
<p>That’s all we have to say about rotations!</p>
</section>
<section id="inserting-into-an-aa-tree">
<h2>Inserting into an AA tree<a class="headerlink" href="#inserting-into-an-aa-tree" title="Permalink to this headline">#</a></h2>
<p>With rotations (<em>i.e.</em> skew and split), it’s fairly easy to implement
insertions into a tree so as to keep the tree balanced. Here is an
outline of the algorithm.</p>
<p>First, insert the new value into the tree by following the branches
based on the value to be inserted and the values at the nodes. If the
new value is smaller than the node value, insert it into the left
subtree, if it’s larger, insert it into the right subtree, and if it’s
the same, then the new value is already in the tree so do nothing. Once
you get to a leaf, replace it with a new node with the new value and two
leaves as children. Of course, we want to do this functionally, so we
aren’t really replacing anything; we are building up a new tree as we go
along out of the parts of the old tree. Therefore, the “replacement”
step is to put in a new node with the new value in place of what was a
leaf in the original tree; this new node has leaves for children.</p>
<p>Now that we have the new value in the tree, we need to make sure that
the tree is balanced, and if not, we need to balance it. The new node we
just created is obviously balanced (it has two leaves as children, both
of which have depth 0), so we look at the parent of that node, and then
the parent of that node, and so on until we reach an unbalanced node or
until we reach the root of the tree. If we find an unbalanced node, we
do a skew followed by a split to balance the tree at that node, and
continue up the tree. Note that we will define the skew and split
operations to do nothing on trees which don’t match the specific pattern
that the rotations are looking for. Note also that we always do the skew
before the split.</p>
<p>That completes our description of AA trees. Now we have to implement
this in OCaml!</p>
</section>
<section id="ocaml-implementation">
<h2>OCaml implementation<a class="headerlink" href="#ocaml-implementation" title="Permalink to this headline">#</a></h2>
<p>Everything in this implementation must be purely functional. <strong>Do not
use imperative code anywhere.</strong> So don’t use <code class="docutils literal notranslate"><span class="pre">ref</span></code>, or the <code class="docutils literal notranslate"><span class="pre">:=</span></code> or
<code class="docutils literal notranslate"><span class="pre">!</span></code> operators, or imperative arrays, or mutable record fields, <em>etc.</em></p>
<p>Recall the definition of the <code class="docutils literal notranslate"><span class="pre">tree</span></code> type given above:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Leaf</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">tree</span> <span class="o">*</span> <span class="n">tree</span>   <span class="c">(* level, value, left/right subtrees *)</span>
</pre></div>
</div>
<p>Here is what you have to implement.</p>
<section id="member">
<h3>1. <code class="docutils literal notranslate"><span class="pre">member</span></code><a class="headerlink" href="#member" title="Permalink to this headline">#</a></h3>
<p>[<strong>2 marks</strong>]</p>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">member</span></code> that takes two arguments: an <code class="docutils literal notranslate"><span class="pre">int</span></code>
and a <code class="docutils literal notranslate"><span class="pre">tree</span></code>, and returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the <code class="docutils literal notranslate"><span class="pre">int</span></code> is present in the
tree, or <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
<p><strong>Note:</strong> The levels of the trees don’t matter for this function.</p>
</section>
<section id="skew-and-split">
<h3>2. <code class="docutils literal notranslate"><span class="pre">skew</span></code> and <code class="docutils literal notranslate"><span class="pre">split</span></code><a class="headerlink" href="#skew-and-split" title="Permalink to this headline">#</a></h3>
<p>[<strong>4 marks</strong>]</p>
<p>Write the two rotation functions described above; call them <code class="docutils literal notranslate"><span class="pre">skew</span></code> and
<code class="docutils literal notranslate"><span class="pre">split</span></code>. Note that not all trees can be changed by a skew or a split
operation; if a tree is not able to be skewed or split, just return the
tree unchanged. Note also that these functions are not recursive; they
only act on the top of the tree.</p>
<p>Both of these functions can be written in a few lines of code each. You
will want to use OCaml’s pattern-matching capabilities on <code class="docutils literal notranslate"><span class="pre">Node</span></code>
constructors. Remember that pattern-matches on recursive datatypes can
be more than one level. For instance, a pattern match on a <code class="docutils literal notranslate"><span class="pre">Node</span></code>
constructor doesn’t have to be just:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="o">-&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">left</span></code> and/or <code class="docutils literal notranslate"><span class="pre">right</span></code> are also <code class="docutils literal notranslate"><span class="pre">Node</span></code>s,
you can put them right into the pattern-match. For instance:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl2</span><span class="o">,</span> <span class="n">v2</span><span class="o">,</span> <span class="n">ll</span><span class="o">,</span> <span class="n">lr</span><span class="o">),</span> <span class="nc">Node</span><span class="o">(</span><span class="n">lvl3</span><span class="o">,</span> <span class="n">v3</span><span class="o">,</span> <span class="n">rl</span><span class="o">,</span> <span class="n">rr</span><span class="o">))</span> <span class="o">-&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If the subtrees are not <code class="docutils literal notranslate"><span class="pre">Node</span></code>s, the pattern won’t match. Of course,
you don’t have to do this sort of thing, but it can shorten the code you
need to write.</p>
<p>When you convert the diagrams given above to the rotation code, make
sure to notice which parts of the trees change and which parts don’t.
This can also shorten the code.</p>
<p>You might find this helper function to be useful:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(* Level of an AA tree. *)</span>
<span class="k">let</span> <span class="n">level</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="mi">0</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">lvl</span>
</pre></div>
</div>
<section id="id1">
<h4>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">let</span> <span class="n">t1</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Leaf</span><span class="o">);;</span>
<span class="k">val</span> <span class="n">t1</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Leaf</span><span class="o">)</span>
<span class="c">(* left horizontal link: need to skew *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">skew</span> <span class="n">t1</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t2</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* balanced *)</span>

<span class="o">#</span> <span class="n">split</span> <span class="n">t2</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* nothing happens *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t3</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">));;</span>
<span class="k">val</span> <span class="n">t3</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* a left horizontal link; need to skew *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t3a</span> <span class="o">=</span> <span class="n">skew</span> <span class="n">t3</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t3a</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)))</span>
<span class="c">(* now we have two consecutive right horizontal links; need to split *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t3b</span> <span class="o">=</span> <span class="n">split</span> <span class="n">t3a</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t3b</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* balanced *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t4</span> <span class="o">=</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
     <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))),</span>
     <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">));;</span>
<span class="k">val</span> <span class="n">t4</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* two right horizontal links on left subtree *)</span>

<span class="o">#</span> <span class="n">skew</span> <span class="n">t4</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
<span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
 <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))),</span>
 <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* nothing happens *)</span>

<span class="o">#</span> <span class="n">split</span> <span class="n">t4</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
<span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
 <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))),</span>
 <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* nothing happens; split only works on the top node *)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t4_left</span> <span class="o">=</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)));;</span>
<span class="k">val</span> <span class="n">t4_left</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)))</span>
<span class="c">(* pull out the left subtree for illustration purposes *)</span>

<span class="o">#</span> <span class="n">skew</span> <span class="n">t4_left</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
<span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)))</span>
<span class="c">(* nothing happens *)</span>

<span class="o">#</span> <span class="n">split</span> <span class="n">t4_left</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
<span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>
<span class="c">(* balanced *)</span>
</pre></div>
</div>
</section>
</section>
<section id="insert">
<h3>3. <code class="docutils literal notranslate"><span class="pre">insert</span></code><a class="headerlink" href="#insert" title="Permalink to this headline">#</a></h3>
<p>[<strong>2 marks</strong>]</p>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">insert</span></code> which inserts an <code class="docutils literal notranslate"><span class="pre">int</span></code> into an AA
tree. Here is a skeleton of the function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">insert</span> <span class="n">item</span> <span class="n">t</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="o">...</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">item</span></code> is an <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span></code> is an AA tree, of course. Note that
<code class="docutils literal notranslate"><span class="pre">lvl</span></code> here means “level”, <code class="docutils literal notranslate"><span class="pre">v</span></code> means “value”, and <code class="docutils literal notranslate"><span class="pre">l</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span></code>
refer to the left and right subtrees of a <code class="docutils literal notranslate"><span class="pre">Node</span></code>. Here is the
algorithm you should use:</p>
<ul class="simple">
<li><p>If the tree <code class="docutils literal notranslate"><span class="pre">t</span></code> is a <code class="docutils literal notranslate"><span class="pre">Leaf</span></code>, return a <code class="docutils literal notranslate"><span class="pre">Node</span></code> with level 1
containing the item; the subtrees should both be <code class="docutils literal notranslate"><span class="pre">Leaf</span></code>.</p></li>
<li><p>If the tree <code class="docutils literal notranslate"><span class="pre">t</span></code> is a <code class="docutils literal notranslate"><span class="pre">Node</span></code> and the value <code class="docutils literal notranslate"><span class="pre">v</span></code> is the same as
the <code class="docutils literal notranslate"><span class="pre">item</span></code> to be inserted, return the original tree. Nothing needs
to be done. (This can be a separate case.)</p></li>
<li><p>Otherwise, compare <code class="docutils literal notranslate"><span class="pre">item</span></code> to <code class="docutils literal notranslate"><span class="pre">v</span></code> and add the node to the left or
right subtree recursively. The resulting tree can be unbalanced, so
do first a skew and then a split operation on that tree, and return
the resulting tree. Make sure you do the skew before the split, or it
won’t work correctly. (The figures shown previously explain why.)</p></li>
</ul>
<section id="id2">
<h4>Examples<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Leaf</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Leaf</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">50</span> <span class="n">t</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t2</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">40</span> <span class="n">t2</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t3</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t4</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">30</span> <span class="n">t3</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t4</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t5</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">33</span> <span class="n">t4</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t5</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t6</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">36</span> <span class="n">t5</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t6</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t7</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">60</span> <span class="n">t6</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t7</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t8</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">70</span> <span class="n">t7</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t8</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t9</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">65</span> <span class="n">t8</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t9</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t10</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">62</span> <span class="n">t9</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t10</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">62</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))))</span>

<span class="o">#</span> <span class="k">let</span> <span class="n">t11</span> <span class="o">=</span> <span class="n">insert</span> <span class="mi">64</span> <span class="n">t10</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">t11</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="nc">Node</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
   <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">),</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">62</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">64</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)),</span>
     <span class="nc">Node</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">))))</span>
</pre></div>
</div>
<p>This function again only needs to be a few lines long. Compared to
nearly all other self-balancing tree algorithms, AA trees are so simple
to implement it’s almost a joke.</p>
</section>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">#</a></h2>
<p>Use the test script to check if your code runs correctly. Here are some
functions that might be useful to you when testing by hand:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(* Level of an AA tree.  Also defined above. *)</span>
<span class="k">let</span> <span class="n">level</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="mi">0</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">l</span>

<span class="c">(* Extract the data value from a node. *)</span>
<span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="c">(* sentinel value; we assume nodes only have positive values *)</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="n">v</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">v</span>

<span class="c">(* Test if a tree is a valid AA tree. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">is_aa_tree</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">levels_ok</span> <span class="n">lvl</span> <span class="n">ll</span> <span class="n">lr</span> <span class="n">parent_lvl</span> <span class="o">=</span>
    <span class="n">lvl</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">lvl</span> <span class="o">=</span> <span class="n">lr</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">||</span> <span class="o">(</span><span class="n">lvl</span> <span class="o">=</span> <span class="n">lr</span> <span class="o">&amp;&amp;</span> <span class="n">lvl</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">parent_lvl</span><span class="o">))</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="n">values_ok</span> <span class="n">v</span> <span class="n">lv</span> <span class="n">rv</span> <span class="o">=</span>
    <span class="k">match</span> <span class="o">(</span><span class="n">lv</span><span class="o">,</span> <span class="n">rv</span><span class="o">)</span> <span class="k">with</span>
      <span class="o">|</span> <span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="bp">true</span>
      <span class="o">|</span> <span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>  <span class="o">-&gt;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">r</span>
      <span class="o">|</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span>  <span class="o">-&gt;</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">l</span>
      <span class="o">|</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>   <span class="o">-&gt;</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">r</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">aux</span> <span class="n">t</span> <span class="n">parent_lvl</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
      <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="bp">true</span>
      <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="k">when</span> <span class="n">lvl</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="bp">false</span>
      <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">lvl</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
        <span class="k">let</span> <span class="n">ll</span> <span class="o">=</span> <span class="n">level</span> <span class="n">l</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">lr</span> <span class="o">=</span> <span class="n">level</span> <span class="n">r</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">lv</span> <span class="o">=</span> <span class="k">value</span> <span class="n">l</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">rv</span> <span class="o">=</span> <span class="k">value</span> <span class="n">r</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">ok_levels</span> <span class="o">=</span> <span class="n">levels_ok</span> <span class="n">lvl</span> <span class="n">ll</span> <span class="n">lr</span> <span class="n">parent_lvl</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">ok_values</span> <span class="o">=</span> <span class="n">values_ok</span> <span class="n">v</span> <span class="n">lv</span> <span class="n">rv</span> <span class="k">in</span>
          <span class="n">ok_levels</span> <span class="o">&amp;&amp;</span> <span class="n">ok_values</span> <span class="o">&amp;&amp;</span> <span class="n">aux</span> <span class="n">l</span> <span class="n">lvl</span> <span class="o">&amp;&amp;</span> <span class="n">aux</span> <span class="n">r</span> <span class="n">lvl</span>
  <span class="k">in</span>
    <span class="c">(* Create a fictitious &quot;parent level&quot; for the root which is</span>
<span class="c">     * one more than the tree level.</span>
<span class="c">     * This is the most permissive case. *)</span>
    <span class="n">aux</span> <span class="n">tree</span> <span class="o">(</span><span class="n">level</span> <span class="n">tree</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="visualizing-your-trees">
<h2>Visualizing your trees<a class="headerlink" href="#visualizing-your-trees" title="Permalink to this headline">#</a></h2>
<p>Finally, it’s easiest to see what’s going on in your code if you can
visualize the trees generated by your code. Here is a function which
will give you a (barely) human-readable display of an AA tree:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">print_tree</span> <span class="n">tree</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">blanks</span> <span class="n">n</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="n">n</span> <span class="sc">&#39; &#39;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">aux</span> <span class="n">tree</span> <span class="n">indent</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">blanks</span> <span class="n">indent</span> <span class="k">in</span>
      <span class="k">match</span> <span class="n">tree</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%sLeaf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">ind</span>
        <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
          <span class="k">begin</span>
            <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%sNode[(%d) [level %d]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">ind</span> <span class="n">v</span> <span class="n">d</span><span class="o">;</span>
            <span class="n">aux</span> <span class="n">l</span> <span class="o">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="o">);</span>
            <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%s  ----</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">ind</span><span class="o">;</span>
            <span class="n">aux</span> <span class="n">r</span> <span class="o">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="o">);</span>
            <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%s]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">ind</span><span class="o">;</span>
          <span class="k">end</span>
  <span class="k">in</span>
    <span class="n">aux</span> <span class="n">tree</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Here’s a useful function to convert a list into a tree; the items in the
list are added to the tree from left to right.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tree_of_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">l</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">insert</span> <span class="n">i</span> <span class="n">l</span><span class="o">)</span> <span class="nc">Leaf</span> <span class="n">lst</span>
</pre></div>
</div>
<p>Here are some examples of how to use these functions:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">let</span> <span class="n">pt</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">print_tree</span> <span class="o">(</span><span class="n">tree_of_list</span> <span class="n">lst</span><span class="o">);;</span>
<span class="k">val</span> <span class="n">pt</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="kt">unit</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">fun</span><span class="o">&gt;</span>

<span class="o">#</span> <span class="n">pt</span> <span class="bp">[]</span><span class="o">;;</span>
<span class="nc">Leaf</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>

<span class="o">#</span> <span class="n">pt</span> <span class="o">[</span><span class="mi">50</span><span class="o">;</span><span class="mi">40</span><span class="o">;</span><span class="mi">30</span><span class="o">];;</span>
<span class="nc">Node</span><span class="o">[(</span><span class="mi">40</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">2</span><span class="o">]</span>
  <span class="nc">Node</span><span class="o">[(</span><span class="mi">30</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
    <span class="nc">Leaf</span>
    <span class="o">----</span>
    <span class="nc">Leaf</span>
  <span class="o">]</span>
  <span class="o">----</span>
  <span class="nc">Node</span><span class="o">[(</span><span class="mi">50</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
    <span class="nc">Leaf</span>
    <span class="o">----</span>
    <span class="nc">Leaf</span>
  <span class="o">]</span>
<span class="o">]</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>

<span class="o">#</span> <span class="n">pt</span> <span class="o">[</span><span class="mi">50</span><span class="o">;</span><span class="mi">40</span><span class="o">;</span><span class="mi">30</span><span class="o">;</span><span class="mi">33</span><span class="o">;</span><span class="mi">36</span><span class="o">;</span><span class="mi">60</span><span class="o">;</span><span class="mi">70</span><span class="o">;</span><span class="mi">65</span><span class="o">;</span><span class="mi">62</span><span class="o">;</span><span class="mi">64</span><span class="o">];;</span>
<span class="nc">Node</span><span class="o">[(</span><span class="mi">40</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">3</span><span class="o">]</span>
  <span class="nc">Node</span><span class="o">[(</span><span class="mi">33</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">2</span><span class="o">]</span>
    <span class="nc">Node</span><span class="o">[(</span><span class="mi">30</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
      <span class="nc">Leaf</span>
      <span class="o">----</span>
      <span class="nc">Leaf</span>
    <span class="o">]</span>
    <span class="o">----</span>
    <span class="nc">Node</span><span class="o">[(</span><span class="mi">36</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
      <span class="nc">Leaf</span>
      <span class="o">----</span>
      <span class="nc">Leaf</span>
    <span class="o">]</span>
  <span class="o">]</span>
  <span class="o">----</span>
  <span class="nc">Node</span><span class="o">[(</span><span class="mi">60</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">2</span><span class="o">]</span>
    <span class="nc">Node</span><span class="o">[(</span><span class="mi">50</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
      <span class="nc">Leaf</span>
      <span class="o">----</span>
      <span class="nc">Leaf</span>
    <span class="o">]</span>
    <span class="o">----</span>
    <span class="nc">Node</span><span class="o">[(</span><span class="mi">65</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">2</span><span class="o">]</span>
      <span class="nc">Node</span><span class="o">[(</span><span class="mi">62</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
        <span class="nc">Leaf</span>
        <span class="o">----</span>
        <span class="nc">Node</span><span class="o">[(</span><span class="mi">64</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
          <span class="nc">Leaf</span>
          <span class="o">----</span>
          <span class="nc">Leaf</span>
        <span class="o">]</span>
      <span class="o">]</span>
      <span class="o">----</span>
      <span class="nc">Node</span><span class="o">[(</span><span class="mi">70</span><span class="o">)</span> <span class="o">[</span><span class="n">level</span> <span class="mi">1</span><span class="o">]</span>
        <span class="nc">Leaf</span>
        <span class="o">----</span>
        <span class="nc">Leaf</span>
      <span class="o">]</span>
    <span class="o">]</span>
  <span class="o">]</span>
<span class="o">]</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
</pre></div>
</div>
<p><span class="raw-html"><hr/></span>
[End of midterm exam]
<span class="raw-html"><hr/></span></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="partB_lists_hofs.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Part B: Recursion and higher-order functions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../../readings/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Readings</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Vanier<br/>
  
      &copy; Copyright 2023, Michael C. Vanier. All rights reserved.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>