
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Part B: More abstraction problems &#8212; The CS 4 book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Part C: Miniproject: Algebraic expressions" href="partC_algebra.html" />
    <link rel="prev" title="Part A: Abstraction" href="partA_abstraction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">The CS 4 book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../admin/index.html">
   Administrative information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Syllabus.html">
     Syllabus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Collaboration_policies.html">
     Collaboration policies
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Motivation.html">
   Motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../History.html">
   History
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../0/Assignment0.html">
     Assignment 0: Getting set up
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../1/index.html">
     Assignment 1: Evaluation and recursion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partA_exercises.html">
       Part A: Basic exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partC_recursion.html">
       Part C: Recursion
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../2/index.html">
     Assignment 2: Asymptotic complexity and higher-order functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partA_orders_of_growth.html">
       Part A: Orders of growth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partC_higher_order_functions.html">
       Part C. Higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partD_additional_problems.html">
       Part D: Additional problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../3/index.html">
     Assignment 3: Lists
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partA_lists.html">
       Part A: Working with lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partB_structural_generative_recursion.html">
       Part B: Structural and generative recursion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partC_more_lists.html">
       Part C: Some harder problems with lists
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Assignment 4: Data abstraction
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partA_abstraction.html">
       Part A: Abstraction
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Part B: More abstraction problems
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partC_algebra.html">
       Part C: Miniproject: Algebraic expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../midterm/index.html">
     Midterm exam
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partA_complexity.html">
       Part A: Asymptotic time complexity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partB_lists_hofs.html">
       Part B: Recursion and higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partC_data_structures.html">
       Part C: Data structures: AA trees
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../5/index.html">
     Assignment 5: Tags and objects
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partA_mutation.html">
       Part A: Mutation and imperative programming
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partB_tagged_data.html">
       Part B: Tagged Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../5/sections/partC_objects.html">
       Part C: Objects
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../readings/index.html">
   Readings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/ocaml_cheat_sheet.html">
     OCaml syntax cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/subst.html">
     The substitution model
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-29">
   1. SICP, problem 2.29
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-30">
   2. SICP, problem 2.30
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-31">
   3. SICP, problem 2.31
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Part B: More abstraction problems</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-29">
   1. SICP, problem 2.29
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-30">
   2. SICP, problem 2.30
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sicp-problem-2-31">
   3. SICP, problem 2.31
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="part-b-more-abstraction-problems">
<h1>Part B: More abstraction problems<a class="headerlink" href="#part-b-more-abstraction-problems" title="Permalink to this headline">#</a></h1>
<section id="sicp-problem-2-29">
<h2>1. <a class="reference external" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-15.html#%_thm_2.29">SICP, problem 2.29</a><a class="headerlink" href="#sicp-problem-2-29" title="Permalink to this headline">#</a></h2>
<p>[<strong>6</strong>] (60 minutes)</p>
<p>A binary mobile consists of two branches, a left branch and a right
branch. Each branch is a rod of a certain length, from which hangs
either a weight or another binary mobile. We can represent a binary
mobile in OCaml using algebraic datatypes:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">mobile</span> <span class="o">=</span> <span class="nc">Mobile</span> <span class="k">of</span> <span class="n">branch</span> <span class="o">*</span> <span class="n">branch</span>  <span class="c">(* left and right branches *)</span>
<span class="ow">and</span> <span class="n">branch</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Weight</span>    <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span>     <span class="c">(* length and weight *)</span>
  <span class="o">|</span> <span class="nc">Structure</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">mobile</span>  <span class="c">(* length and sub-mobile *)</span>
</pre></div>
</div>
<p>Note that these types are mutually recursive, which is why we define
them with <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">...</span> <span class="pre">and</span> <span class="pre">...</span></code>. Note that this <code class="docutils literal notranslate"><span class="pre">type</span></code> declaration
defines <em>two</em> types; <code class="docutils literal notranslate"><span class="pre">mobile</span></code> and <code class="docutils literal notranslate"><span class="pre">branch</span></code> are each distinct types.</p>
<p>Here is an incomplete abstraction layer around these types:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">make_mobile</span> <span class="n">l</span> <span class="n">r</span> <span class="o">=</span> <span class="nc">Mobile</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>
<span class="k">let</span> <span class="n">make_weight</span> <span class="n">l</span> <span class="n">w</span> <span class="o">=</span> <span class="nc">Weight</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">w</span><span class="o">)</span>
<span class="k">let</span> <span class="n">make_structure</span> <span class="n">l</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">Structure</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span>
</pre></div>
</div>
<ol class="loweralpha">
<li><p>Complete the abstraction layer by defining accessors (which SICP
calls “selectors”). Define <code class="docutils literal notranslate"><span class="pre">left_branch</span></code> and <code class="docutils literal notranslate"><span class="pre">right_branch</span></code> to
return the branches of a mobile, <code class="docutils literal notranslate"><span class="pre">branch_length</span></code> to return a
branch’s length, and <code class="docutils literal notranslate"><span class="pre">branch_structure</span></code> to return a branch’s
structure. <code class="docutils literal notranslate"><span class="pre">branch_structure</span></code> should return a polymorphic variant
which will use the tag <code class="docutils literal notranslate"><span class="pre">`Weight</span></code> along with an integer weight if
the structure is a weight, or <code class="docutils literal notranslate"><span class="pre">`Structure</span></code> along with a mobile
if the structure is a (sub-)mobile. Neither the <code class="docutils literal notranslate"><span class="pre">`Weight</span></code> nor
the <code class="docutils literal notranslate"><span class="pre">`Structure</span></code> variant should contain the length of the branch
(<em>i.e.</em> they are not just copies of the <code class="docutils literal notranslate"><span class="pre">Weight</span></code> and <code class="docutils literal notranslate"><span class="pre">Structure</span></code>
constructors of the <code class="docutils literal notranslate"><span class="pre">branch</span></code> type).</p></li>
<li><p>Write the functions <code class="docutils literal notranslate"><span class="pre">branch_weight1</span></code> and <code class="docutils literal notranslate"><span class="pre">total_weight1</span></code> which
return the weight of a branch and the total weight of a mobile,
respectively. These functions should directly use the representation
of the data types <code class="docutils literal notranslate"><span class="pre">mobile</span></code> and <code class="docutils literal notranslate"><span class="pre">branch</span></code>. These functions will
need to be mutually recursive, so use the <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">rec</span> <span class="pre">...</span> <span class="pre">and</span> <span class="pre">...</span></code>
syntactic form when defining them.</p>
<p>Then write new versions of these functions called <code class="docutils literal notranslate"><span class="pre">branch_weight2</span></code>
and <code class="docutils literal notranslate"><span class="pre">total_weight2</span></code> which only use the abstraction layer functions.
These will also be mutually recursive. Make sure you don’t
inadvertently call <code class="docutils literal notranslate"><span class="pre">branch_weight1</span></code> or <code class="docutils literal notranslate"><span class="pre">total_weight1</span></code> in either
function!</p>
<p>Clearly, <code class="docutils literal notranslate"><span class="pre">branch_weight1</span></code> and <code class="docutils literal notranslate"><span class="pre">branch_weight2</span></code> must be different
functions (and similarly for the <code class="docutils literal notranslate"><span class="pre">total_weight1</span></code> and
<code class="docutils literal notranslate"><span class="pre">total_weight2</span></code> functions) but they should return the same results
given the same inputs.</p>
</li>
<li><p>A mobile is said to be <em>balanced</em> if the torque applied by its
top-left branch is equal to that applied by its top-right branch
(that is, if the length of the left rod multiplied by the weight
hanging from that rod is equal to the corresponding product for the
right side) and if each of the submobiles hanging off its branches is
balanced. Design a predicate <code class="docutils literal notranslate"><span class="pre">is_balanced</span></code> that returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if
a mobile is balanced according to this criterion. This function
should <em>only</em> use the abstraction layer functions described above. In
other words, it will be independent of the internal structure of the
mobile. We will be taking advantage of this fact below.</p></li>
<li><p>Suppose we change the representation of mobiles so that the
constructors are</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">mobile&#39;</span>  <span class="o">=</span> <span class="o">{</span> <span class="n">left</span><span class="o">:</span> <span class="n">branch&#39;</span><span class="o">;</span> <span class="n">right</span><span class="o">:</span> <span class="n">branch&#39;</span> <span class="o">}</span>
<span class="ow">and</span>  <span class="n">branch&#39;</span>  <span class="o">=</span> <span class="nc">Branch&#39;</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">contents</span>
<span class="ow">and</span>  <span class="n">contents</span> <span class="o">=</span> <span class="nc">Weight&#39;</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">|</span> <span class="nc">Structure&#39;</span> <span class="k">of</span> <span class="n">mobile&#39;</span>
</pre></div>
</div>
<p>Write a new abstraction layer around the new representation. Call the
new functions <code class="docutils literal notranslate"><span class="pre">make_mobile'</span></code>, <code class="docutils literal notranslate"><span class="pre">make_weight'</span></code>,
<code class="docutils literal notranslate"><span class="pre">make_structure'</span></code>, <code class="docutils literal notranslate"><span class="pre">left_branch'</span></code>, <code class="docutils literal notranslate"><span class="pre">right_branch'</span></code>,
<code class="docutils literal notranslate"><span class="pre">branch_length'</span></code> and <code class="docutils literal notranslate"><span class="pre">branch_structure'</span></code>. They should return the
same kinds of values as their unprimed counterparts, taking into
account the new representation of mobiles and branches.</p>
<p>Modify your functions <code class="docutils literal notranslate"><span class="pre">branch_weight2</span></code> and <code class="docutils literal notranslate"><span class="pre">total_weight2</span></code> so
that they work with the new abstraction layer. Call the new versions
<code class="docutils literal notranslate"><span class="pre">branch_weight'</span></code> and <code class="docutils literal notranslate"><span class="pre">total_weight'</span></code>. If you wrote
<code class="docutils literal notranslate"><span class="pre">branch_weight2</span></code> and <code class="docutils literal notranslate"><span class="pre">total_weight2</span></code> correctly (only using the
abstraction layer functions), this will be trivial (you’ll just have
to change the names of the abstraction layer functions in the
corresponding function definitions). If not, go back and do that now!
<svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-smiley smiley" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM5 8a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zM5.32 9.636a.75.75 0 011.038.175l.007.009c.103.118.22.222.35.31.264.178.683.37 1.285.37.602 0 1.02-.192 1.285-.371.13-.088.247-.192.35-.31l.007-.008a.75.75 0 111.222.87l-.614-.431c.614.43.614.431.613.431v.001l-.001.002-.002.003-.005.007-.014.019a1.984 1.984 0 01-.184.213c-.16.166-.338.316-.53.445-.63.418-1.37.638-2.127.629-.946 0-1.652-.308-2.126-.63a3.32 3.32 0 01-.715-.657l-.014-.02-.005-.006-.002-.003v-.002h-.001l.613-.432-.614.43a.75.75 0 01.183-1.044h.001z"></path></svg></p>
<p>Finally, write a version of <code class="docutils literal notranslate"><span class="pre">is_balanced</span></code> which works with the new
representation; call it <code class="docutils literal notranslate"><span class="pre">is_balanced'</span></code>. Again, if you have done
everything right so far, this will be trivial (just involving name
changes from the unprimed to the primed versions).</p>
</li>
</ol>
<p>The main advantage of defining an abstraction layer is so you can
rewrite the internal structure of a datatype without having to change
much code. Here, for the sake of testing, we are preserving all versions
of the abstraction layer functions and functions which depend on them.
In a real world scenario, after changing the internal representation of
mobiles we would simply change <em>e.g.</em> the <code class="docutils literal notranslate"><span class="pre">make_mobile</span></code>,
<code class="docutils literal notranslate"><span class="pre">make_weight</span></code>, <code class="docutils literal notranslate"><span class="pre">make_structure</span></code>, <code class="docutils literal notranslate"><span class="pre">left_branch</span></code> and
<code class="docutils literal notranslate"><span class="pre">right_branch</span></code> functions to use the new representation. After that,
all other code could remain the same.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Later in the course we will cover <em>modules</em> and <em>functors</em>,
which are OCaml language features that allows us to define
multiple different implementations of data structures
as well as the abstraction layers built on top of them
in a very convenient way.
Modules and functors have many other uses as well.
Currently, only OCaml or languages related to OCaml have functors. <a class="footnote-reference brackets" href="#id2" id="id1">1</a></p>
</div>
<p>Here are some test cases you should use to test both representations.
(You’ll have to modify the <code class="docutils literal notranslate"><span class="pre">make_xxx</span></code> names to work with the second
representation.)</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">m0</span> <span class="o">=</span>
  <span class="n">make_mobile</span>
    <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="mi">1</span><span class="o">)</span>

<span class="k">let</span> <span class="n">m1</span> <span class="o">=</span>
  <span class="n">make_mobile</span>
    <span class="o">(</span><span class="n">make_weight</span> <span class="mi">3</span> <span class="mi">4</span><span class="o">)</span>
    <span class="o">(</span><span class="n">make_structure</span>
      <span class="mi">4</span>
      <span class="o">(</span><span class="n">make_mobile</span>
        <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">)</span>
        <span class="o">(</span><span class="n">make_weight</span> <span class="mi">2</span> <span class="mi">1</span><span class="o">)))</span>

<span class="k">let</span> <span class="n">m2</span> <span class="o">=</span>
  <span class="n">make_mobile</span>
    <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="mi">400</span><span class="o">)</span>
    <span class="o">(</span><span class="n">make_structure</span>
      <span class="mi">10</span>
      <span class="o">(</span><span class="n">make_mobile</span>
        <span class="o">(</span><span class="n">make_weight</span> <span class="mi">100</span> <span class="mi">1</span><span class="o">)</span>
        <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="mi">200</span><span class="o">)))</span>

<span class="k">let</span> <span class="n">m3</span> <span class="o">=</span>
  <span class="n">make_mobile</span>
    <span class="o">(</span><span class="n">make_weight</span> <span class="mi">1</span> <span class="o">(</span><span class="n">total_weight1</span> <span class="n">m2</span><span class="o">))</span>
    <span class="o">(</span><span class="n">make_structure</span> <span class="mi">1</span> <span class="n">m2</span><span class="o">)</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">total_weight</span> <span class="n">m0</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">#</span> <span class="n">is_balanced</span> <span class="n">m0</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">true</span>
<span class="o">#</span> <span class="n">total_weight</span> <span class="n">m1</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">7</span>
<span class="o">#</span> <span class="n">is_balanced</span> <span class="n">m1</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">true</span>
<span class="o">#</span> <span class="n">total_weight</span> <span class="n">m2</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">601</span>
<span class="o">#</span> <span class="n">is_balanced</span> <span class="n">m2</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">false</span>
<span class="o">#</span> <span class="n">total_weight</span> <span class="n">m3</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">1202</span>
<span class="o">#</span> <span class="n">is_balanced</span> <span class="n">m3</span> <span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">false</span>
</pre></div>
</div>
</section>
<section id="sicp-problem-2-30">
<h2>2. <a class="reference external" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-15.html#%_thm_2.30">SICP, problem 2.30</a><a class="headerlink" href="#sicp-problem-2-30" title="Permalink to this headline">#</a></h2>
<p>[<strong>3</strong>] (30 minutes)</p>
<p>A <em>tree</em> is a kind of data structure. There are many different kinds of
tree-like data structures used in computer programming. One example is
the following:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Tree</span> <span class="k">of</span> <span class="n">elem</span> <span class="kt">list</span>
<span class="ow">and</span> <span class="n">elem</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Num</span> <span class="k">of</span> <span class="kt">int</span>
  <span class="o">|</span> <span class="nc">Sub</span> <span class="k">of</span> <span class="n">tree</span>
</pre></div>
</div>
<p>This defines a tree where each component of the tree can be an integer
or a subtree, and where a tree can have arbitrarily many components.
Define a function called <code class="docutils literal notranslate"><span class="pre">square_tree</span></code> which will make a copy of a
tree, except that all numbers in the tree will be squared. That is,
<code class="docutils literal notranslate"><span class="pre">square_tree</span></code> should behave as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">square_tree</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">1</span><span class="o">;</span>
                     <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">2</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">3</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">4</span><span class="o">]);</span> <span class="nc">Num</span> <span class="mi">5</span><span class="o">]);</span>
                     <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">6</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">7</span><span class="o">])])</span>
<span class="o">-</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">1</span><span class="o">;</span>
                 <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">4</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">9</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">16</span><span class="o">]);</span> <span class="nc">Num</span> <span class="mi">25</span><span class="o">]);</span>
                 <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">36</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">49</span><span class="o">])]</span>
</pre></div>
</div>
<p>Define <code class="docutils literal notranslate"><span class="pre">square_tree</span></code> both directly (<em>i.e.</em>, without using any
higher-order functions) and also by using the <code class="docutils literal notranslate"><span class="pre">map</span></code> higher-order
function (which is called <code class="docutils literal notranslate"><span class="pre">List.map</span></code> in Ocaml). Call the first
function <code class="docutils literal notranslate"><span class="pre">square_tree</span></code> and the second one <code class="docutils literal notranslate"><span class="pre">square_tree'</span></code>.</p>
<p>Use these tests:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">tree1</span> <span class="o">=</span> <span class="nc">Tree</span>
  <span class="o">[</span><span class="nc">Num</span> <span class="mi">10</span><span class="o">;</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">20</span><span class="o">;</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">42</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span> <span class="nc">Num</span> <span class="mi">12</span><span class="o">]);</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">13</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">)])]);</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">1</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">2</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">3</span><span class="o">])]</span>

<span class="k">let</span> <span class="n">tree2</span> <span class="o">=</span> <span class="nc">Tree</span>
  <span class="o">[</span><span class="nc">Num</span> <span class="mi">100</span><span class="o">;</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">400</span><span class="o">;</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">1764</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span> <span class="nc">Num</span> <span class="mi">144</span><span class="o">]);</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span>
              <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">169</span><span class="o">;</span> <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">)])]);</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="bp">[]</span><span class="o">);</span>
   <span class="nc">Sub</span> <span class="o">(</span><span class="nc">Tree</span> <span class="o">[</span><span class="nc">Num</span> <span class="mi">1</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">4</span><span class="o">;</span> <span class="nc">Num</span> <span class="mi">9</span><span class="o">])]</span>

<span class="c">(* Check that these are equal: *)</span>
<span class="c">(*</span>
<span class="c">square_tree  (Tree []) = (Tree [])</span>
<span class="c">square_tree&#39; (Tree []) = (Tree [])</span>
<span class="c">square_tree  tree1 = tree2</span>
<span class="c">square_tree&#39; tree1 = tree2</span>
<span class="c">*)</span>
</pre></div>
</div>
</section>
<section id="sicp-problem-2-31">
<h2>3. <a class="reference external" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-15.html#%_thm_2.31">SICP, problem 2.31</a><a class="headerlink" href="#sicp-problem-2-31" title="Permalink to this headline">#</a></h2>
<p>[<strong>1</strong>] (15 minutes)</p>
<p>Abstract your answer to the previous problem to produce a function
<code class="docutils literal notranslate"><span class="pre">tree_map</span></code> with the property that a version of <code class="docutils literal notranslate"><span class="pre">square_tree</span></code> could
be defined as:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">square_tree&#39;&#39;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">tree_map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="o">)</span> <span class="n">tree</span>
</pre></div>
</div>
<p>The solution is very short.</p>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Many other languages (for instance, Haskell and C++)
have a feature that they <em>call</em> “functors”,
but they are not at all like OCaml functors.
It seems like every language defines the word “functor”
to mean something completely different.</p>
</dd>
</dl>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="partA_abstraction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Part A: Abstraction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="partC_algebra.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Part C: Miniproject: Algebraic expressions</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Vanier<br/>
  
      &copy; Copyright 2023, Michael C. Vanier. All rights reserved.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>