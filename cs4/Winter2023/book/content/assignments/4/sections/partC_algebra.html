
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Part C: Miniproject: Algebraic expressions &#8212; The CS 4 book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Midterm exam" href="../../midterm/index.html" />
    <link rel="prev" title="Part B: More abstraction problems" href="partB_more_abstraction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">The CS 4 book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../admin/index.html">
   Administrative information
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Syllabus.html">
     Syllabus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../admin/Collaboration_policies.html">
     Collaboration policies
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Motivation.html">
   Motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../History.html">
   History
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../0/Assignment0.html">
     Assignment 0: Getting set up
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../1/index.html">
     Assignment 1: Evaluation and recursion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partA_exercises.html">
       Part A: Basic exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../1/sections/partC_recursion.html">
       Part C: Recursion
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../2/index.html">
     Assignment 2: Asymptotic complexity and higher-order functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partA_orders_of_growth.html">
       Part A: Orders of growth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partB_evaluation.html">
       Part B: Evaluation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partC_higher_order_functions.html">
       Part C. Higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../2/sections/partD_additional_problems.html">
       Part D: Additional problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../3/index.html">
     Assignment 3: Lists
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partA_lists.html">
       Part A: Working with lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partB_structural_generative_recursion.html">
       Part B: Structural and generative recursion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../3/sections/partC_more_lists.html">
       Part C: Some harder problems with lists
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../index.html">
     Assignment 4: Data abstraction
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partA_abstraction.html">
       Part A: Abstraction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="partB_more_abstraction.html">
       Part B: More abstraction problems
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Part C: Miniproject: Algebraic expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../midterm/index.html">
     Midterm exam
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/Preamble.html">
       Preamble
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/ocaml_notes.html">
       OCaml notes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partA_complexity.html">
       Part A: Asymptotic time complexity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partB_lists_hofs.html">
       Part B: Recursion and higher-order functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../midterm/sections/partC_data_structures.html">
       Part C: Data structures: AA trees
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../readings/index.html">
   Readings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/ocaml_cheat_sheet.html">
     OCaml syntax cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../readings/subst.html">
     The substitution model
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simplification">
   1. Simplification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differentiation">
   2. Differentiation
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Part C: Miniproject: Algebraic expressions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simplification">
   1. Simplification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differentiation">
   2. Differentiation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="part-c-miniproject-algebraic-expressions">
<h1>Part C: Miniproject: Algebraic expressions<a class="headerlink" href="#part-c-miniproject-algebraic-expressions" title="Permalink to this headline">#</a></h1>
<p>(Loosely “derived” from <a class="reference external" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%_thm_2.56">SICP, problem 2.56</a>.)</p>
<p>One of the best things about OCaml is how easy it is to express
complicated data structures using algebraic datatypes. We will use this
facility to represent algebraic expressions (real algebra, like you
learned in high school) and perform interesting tasks on them.</p>
<p>We will use the type <code class="docutils literal notranslate"><span class="pre">expr</span></code> to represent algebraic expressions. Its
definition is:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">expr</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Int</span> <span class="k">of</span> <span class="kt">int</span>           <span class="c">(* constant *)</span>
  <span class="o">|</span> <span class="nc">Var</span> <span class="k">of</span> <span class="kt">string</span>        <span class="c">(* variable *)</span>
  <span class="o">|</span> <span class="nc">Add</span> <span class="k">of</span> <span class="n">expr</span> <span class="o">*</span> <span class="n">expr</span>   <span class="c">(* expr1 + expr2 *)</span>
  <span class="o">|</span> <span class="nc">Mul</span> <span class="k">of</span> <span class="n">expr</span> <span class="o">*</span> <span class="n">expr</span>   <span class="c">(* expr1 * expr2 *)</span>
  <span class="o">|</span> <span class="nc">Pow</span> <span class="k">of</span> <span class="n">expr</span> <span class="o">*</span> <span class="kt">int</span>    <span class="c">(* expr^n *)</span>
</pre></div>
</div>
<p>There is one non-structural constraint that we will impose on this type:
the exponent in a <code class="docutils literal notranslate"><span class="pre">Pow</span></code> expression must be a non-negative integer.</p>
<p>Clearly, expressions in this type can’t represent all possible algebraic
expressions, but they can represent a lot of cases of interest (<em>e.g.</em>
polynomials with arbitrary numbers of variables), and it would be easy
to extend this type to deal with more complex kinds of algebraic
expressions.</p>
<p>It’s possible to write a parser from algebraic expressions written in
the usual mathematical notation to this datatype, but we won’t do that
here. Instead, we will directly use the datatype constructors to build
our expressions (we’re not worrying about abstraction here either). Some
example expressions written in this form would be:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="mi">42</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">42</span>

<span class="n">x</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>

<span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">--&gt;</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">)</span>

<span class="o">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="o">(-</span><span class="mi">1</span><span class="o">)),</span> <span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">))</span>

<span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">--&gt;</span>
  <span class="nc">Add</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">6</span><span class="o">,</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">))),</span> <span class="nc">Int</span> <span class="o">(-</span><span class="mi">1</span><span class="o">))</span>
</pre></div>
</div>
<p>Once we have an algebraic expression in this form, we can do a number of
interesting manipulations on it. We will do two of these in this
section.</p>
<section id="simplification">
<h2>1. Simplification<a class="headerlink" href="#simplification" title="Permalink to this headline">#</a></h2>
<p>[<strong>5</strong>] (30 minutes)</p>
<p>Many algebraic expressions can be converted into equivalent but simpler
algebraic expressions. This process is called “simplifying” the
algebraic expression. Simplification is a difficult problem in general,
because there can be many mutually-exclusive definitions of what
“simpler” means. However, some simplifications are universally agreed
upon. For instance:</p>
<ul class="simple">
<li><p>An expression which adds two integers can be replaced by a single
integer (the sum of the two integers).</p></li>
<li><p>An expression which multiplies two integers can be replaced by a
single integer (the product of the two integers).</p></li>
<li><p>An expression which takes an integer to the power of another integer
can be replaced by a single integer (the power of the two integers).</p></li>
<li><p>An expression which adds zero to another expression E is just the
expression E.</p></li>
<li><p>An expression which multiplies an expression E by 0 is just 0.</p></li>
<li><p>An expression which multiplies an expression E by 1 is just E.</p></li>
<li><p>An expression which raises an expression E to the power of 0 is just
1 (we are ignoring the tricky case of 0 to the power of 0 here).</p></li>
<li><p>An expression which raises an expression E to the power of 1 is just
E.</p></li>
</ul>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">simplify1</span></code> which does all of these
simplifications on an algebraic expression represented as a value of the
type <code class="docutils literal notranslate"><span class="pre">expr</span></code>. Make sure that you consider the cases where <em>e.g.</em> 0 is
added to an expression from the left or from the right, and similarly
for other simplifications. Also, if an expression can’t itself be
simplified, try to recursively simplify its subexpressions.</p>
<p>One thing that makes simplification difficult is that simplifying an
expression can yield another expression which can itself be simplified.
The best way to handle this is to repeat the simplification process
until no more simplification can be performed. We are providing you with
the following function <code class="docutils literal notranslate"><span class="pre">simplify</span></code> which will call your <code class="docutils literal notranslate"><span class="pre">simplify1</span></code>
function to simplify an expression until no more of the simplifications
described above are possible:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">simplify</span> <span class="n">expr</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="n">simplify1</span> <span class="n">expr</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">e</span>
      <span class="k">then</span> <span class="n">expr</span>
      <span class="k">else</span> <span class="n">simplify</span> <span class="n">e</span>
</pre></div>
</div>
<p>Technically, we say that <code class="docutils literal notranslate"><span class="pre">simplify</span></code> computes the <em>fixpoint</em> of
<code class="docutils literal notranslate"><span class="pre">simplify1</span></code>. This makes the definition of <code class="docutils literal notranslate"><span class="pre">simplify1</span></code> simpler. For
instance, if you simplify <code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">+</span> <span class="pre">0</span></code> to just <code class="docutils literal notranslate"><span class="pre">E</span></code>, you don’t then have
to recurse on <code class="docutils literal notranslate"><span class="pre">E</span></code> in the <code class="docutils literal notranslate"><span class="pre">simplify1</span></code> function, because the
expression <code class="docutils literal notranslate"><span class="pre">E</span></code> will be simplified again by the <code class="docutils literal notranslate"><span class="pre">simplify</span></code> function
until it can’t be simplified any more. On the other hand, if you have an
expression <code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">+</span> <span class="pre">F</span></code> which can’t be simplified by any of the rules
above, you have to recursively simplify the parts (<code class="docutils literal notranslate"><span class="pre">E</span></code> and <code class="docutils literal notranslate"><span class="pre">F</span></code>),
because if you don’t, calling <code class="docutils literal notranslate"><span class="pre">simplify1</span></code> on this expression again
won’t do anything.</p>
<p>Here are some expressions to test your simplifier. These represent the
results after <code class="docutils literal notranslate"><span class="pre">simplify</span></code> has been called (not just <code class="docutils literal notranslate"><span class="pre">simplify1</span></code>).</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="nc">Int</span> <span class="mi">42</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">42</span>
<span class="nc">Var</span> <span class="s2">&quot;x&quot;</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>
<span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">32</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">41</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">73</span>
<span class="nc">Add</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">4</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">10</span>
<span class="nc">Add</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">4</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">14</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">4</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">24</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">4</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">36</span>
<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">1</span>
<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">100</span>
<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">2</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">9</span>

<span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">0</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>
<span class="nc">Add</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">0</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;z&quot;</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;z&quot;</span>
<span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;z&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">1</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;z&quot;</span>
<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">1</span>
<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>

<span class="nc">Pow</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">0</span><span class="o">),</span> <span class="mi">1</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>
<span class="nc">Add</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">0</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">0</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span>
</pre></div>
</div>
</section>
<section id="differentiation">
<h2>2. Differentiation<a class="headerlink" href="#differentiation" title="Permalink to this headline">#</a></h2>
<p>[<strong>5</strong>] (20 minutes)</p>
<p>Another fun thing you can do with algebraic expressions represented
programmatically is to symbolically differentiate them (<em>i.e.</em> compute
their derivatives with respect to some variable). Specifically, you need
to implement the following differentiation rules:</p>
<ol class="arabic simple">
<li><p>Differentiating any constant gives zero.</p></li>
<li><p>Differentiating a variable by the same variable gives 1; for a
different variable it gives zero.</p></li>
<li><p>Differentiating a sum by a variable is done by differentiating the
components of the sum separately and then adding them up.</p></li>
<li><p>Differentiating a product by a variable uses the <a class="reference external" href="https://en.wikipedia.org/wiki/Product_rule">product rule</a>:
the derivative of
<span class="math notranslate nohighlight">\(e_1 \times e_2\)</span> by <span class="math notranslate nohighlight">\(x\)</span> is
<span class="math notranslate nohighlight">\(\frac{d}{dx} e_1 \times e_2 + e_1 \times \frac{d}{dx} e_2\)</span>.</p></li>
<li><p>Differentiating an expression raised to a (positive) integer power
uses the <a class="reference external" href="https://en.wikipedia.org/wiki/Power_rule">power rule</a>: the derivative of
<span class="math notranslate nohighlight">\(e^n\)</span> by <span class="math notranslate nohighlight">\(x\)</span> is
<span class="math notranslate nohighlight">\(n \times e^{n-1} \times \frac{d}{dx} e\)</span>.</p></li>
</ol>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">deriv</span></code> which implements all of these rules.
It’s beneficial if the expression to be differentiated is simplified
before and after computing the derivative, so use this wrapper function
when testing your function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">derivative</span> <span class="n">var</span> <span class="n">expr</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="n">simplify</span> <span class="n">expr</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="n">deriv</span> <span class="n">var</span> <span class="n">e</span> <span class="k">in</span>
    <span class="n">simplify</span> <span class="n">d</span>
</pre></div>
</div>
<div class="formalpara-title docutils container">
<p><strong>Examples</strong></p>
</div>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">10</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">1</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">2</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">),</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">3</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Int</span> <span class="mi">42</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">42</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span>
<span class="n">derivative</span> <span class="s2">&quot;z&quot;</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">)))</span> <span class="o">--&gt;</span>
           <span class="nc">Add</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">),</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">)),</span>
                <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Int</span> <span class="mi">3</span><span class="o">))</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;y&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">0</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Int</span> <span class="mi">1</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span> <span class="o">--&gt;</span> <span class="nc">Mul</span> <span class="o">((</span><span class="nc">Int</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">))</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Pow</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">),</span> <span class="mi">3</span><span class="o">))</span> <span class="o">--&gt;</span>
           <span class="nc">Mul</span>
            <span class="o">(</span><span class="nc">Mul</span>
              <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span>
                <span class="nc">Pow</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">),</span> <span class="mi">2</span><span class="o">)),</span>
              <span class="nc">Int</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">derivative</span> <span class="s2">&quot;x&quot;</span> <span class="o">(</span><span class="nc">Add</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">4</span><span class="o">,</span> <span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">3</span><span class="o">)),</span>
                     <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">6</span><span class="o">,</span> <span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">))))</span> <span class="o">--&gt;</span>
           <span class="nc">Add</span> <span class="o">(</span><span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">4</span><span class="o">,</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">3</span><span class="o">,</span> <span class="nc">Pow</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">))),</span>
                <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">6</span><span class="o">,</span> <span class="nc">Mul</span> <span class="o">(</span><span class="nc">Int</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">Var</span> <span class="s2">&quot;x&quot;</span><span class="o">)))</span>
</pre></div>
</div>
<p>If your code produces these results, but with some of the terms
rearranged (<em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">Mul</span> <span class="pre">(Var</span> <span class="pre">&quot;x&quot;,</span> <span class="pre">Int</span> <span class="pre">2)</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">Mul</span> <span class="pre">(Int</span> <span class="pre">2,</span> <span class="pre">Var</span> <span class="pre">&quot;x&quot;)</span></code>, we’ll accept it. However, the results should
be equivalent. <em>Note</em>: the test script may fail on correct answers in
this case; don’t assume that there is a bug! Instead, try the failing
examples interactively and see if your result is reasonable.</p>
<p>Our solution is less than ten lines long.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="partB_more_abstraction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Part B: More abstraction problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../midterm/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Midterm exam</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael Vanier<br/>
  
      &copy; Copyright 2023, Michael C. Vanier. All rights reserved.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>