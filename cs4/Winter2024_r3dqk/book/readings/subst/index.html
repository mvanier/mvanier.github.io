
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mvanier.github.io/cs4/Winter2024/book/readings/subst/">
      
      
        <link rel="prev" href="../ocaml_cheat_sheet/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>The Substitution Model - The CS 4 book (Winter 2024)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-substitution-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The CS 4 book (Winter 2024)" class="md-header__button md-logo" aria-label="The CS 4 book (Winter 2024)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The CS 4 book (Winter 2024)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Substitution Model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to medium mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to medium mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="medium" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18V6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The CS 4 book (Winter 2024)" class="md-nav__button md-logo" aria-label="The CS 4 book (Winter 2024)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    The CS 4 book (Winter 2024)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/welcome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to CS 4!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/motivation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Motivation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    History
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Administrative
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administrative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/syllabus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Syllabus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/collab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collaboration policies
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Assignments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/0/assignment0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assignment 0: Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 1: Evaluation and recursion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Assignment 1: Evaluation and recursion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/1/assignment1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/1/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/1/partA_exercises/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Exercises
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/1/partB_evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/1/partC_recursion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Recursion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 2: Complexity and HOFs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Assignment 2: Complexity and HOFs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/assignment2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/partA_orders_of_growth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Orders of growth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/partB_evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/partC_higher_order_functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Higher-order functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/2/partD_additional_problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part D: Additional problems
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 3: Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Assignment 3: Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/3/assignment3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/3/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/3/partA_lists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Working with lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/3/partB_structural_generative_recursion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Structural and Generative Recursion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/3/partC_more_lists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Some harder problems with lists
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 4: Data abstraction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Assignment 4: Data abstraction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/4/assignment4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/4/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/4/partA_abstraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Abstraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/4/partB_more_abstraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: More abstraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/4/partC_algebra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Algebraic expressions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Midterm exam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Midterm exam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/midterm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/midterm/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/midterm/partA_complexity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Complexity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/midterm/partB_lists_hofs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Lists and HOFs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/midterm/partC_data_structures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Data structures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 5: Tags and objects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Assignment 5: Tags and objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/5/assignment5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/5/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/5/partA_imperative/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Imperative programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/5/partB_tagged_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Tagged data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/5/partC_objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Objects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 6: Environmentally-friendly
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Assignment 6: Environmentally-friendly
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/assignment6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/partA_environment_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: Environment model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/partB_imperative_objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: Imperative objects and classes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/partC_modules_functors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: Modules and functors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/6/partD_special_topics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part D: Special topics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Assignment 7: Final exam preparation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Assignment 7: Final exam preparation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/7/assignment7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/7/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/7/klotski_game/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The "Klotski" sliding-block puzzle game
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/7/partA_klotski_board/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: the Klotski module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/7/partB_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: the Search functor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Final exam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            Final exam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/final_exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/ocaml_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/background/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Background information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/partA_binmat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part A: The Binmat module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/partB_solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part B: The Solver module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/partC_pentomino/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part C: The Pentomino module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/final/rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The rest of the program
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Readings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Readings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ocaml_cheat_sheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    The Substitution Model
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    The Substitution Model
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desugaring-and-precedence" class="md-nav__link">
    <span class="md-ellipsis">
      Desugaring and precedence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Desugaring and precedence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desugaring" class="md-nav__link">
    <span class="md-ellipsis">
      Desugaring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#precedence" class="md-nav__link">
    <span class="md-ellipsis">
      Precedence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-basic-rule" class="md-nav__link">
    <span class="md-ellipsis">
      The basic rule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specific-cases-of-the-basic-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Specific cases of the basic rule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#let-bound-names" class="md-nav__link">
    <span class="md-ellipsis">
      let-bound names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="let-bound names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#top-level-let-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Top-level let expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-let-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Local let expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      if expressions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="if expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-without-else" class="md-nav__link">
    <span class="md-ellipsis">
      if without else
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fun-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      fun expressions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-application" class="md-nav__link">
    <span class="md-ellipsis">
      Function application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Function application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applying-built-in-functions-or-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Applying built-in functions or operators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-user-defined-functions-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      Applying user-defined functions: substitution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Recursion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-fun-expressions-and-shielding" class="md-nav__link">
    <span class="md-ellipsis">
      Nested fun expressions and shielding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desugaring-and-precedence" class="md-nav__link">
    <span class="md-ellipsis">
      Desugaring and precedence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Desugaring and precedence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desugaring" class="md-nav__link">
    <span class="md-ellipsis">
      Desugaring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#precedence" class="md-nav__link">
    <span class="md-ellipsis">
      Precedence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-basic-rule" class="md-nav__link">
    <span class="md-ellipsis">
      The basic rule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specific-cases-of-the-basic-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Specific cases of the basic rule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#let-bound-names" class="md-nav__link">
    <span class="md-ellipsis">
      let-bound names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="let-bound names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#top-level-let-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Top-level let expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-let-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Local let expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      if expressions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="if expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-without-else" class="md-nav__link">
    <span class="md-ellipsis">
      if without else
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fun-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      fun expressions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-application" class="md-nav__link">
    <span class="md-ellipsis">
      Function application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Function application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#applying-built-in-functions-or-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Applying built-in functions or operators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-user-defined-functions-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      Applying user-defined functions: substitution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Recursion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-fun-expressions-and-shielding" class="md-nav__link">
    <span class="md-ellipsis">
      Nested fun expressions and shielding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="the-substitution-model">The substitution model</h1>
<p>This reading is a summary of the rules of the substitution model,
discussed starting in lecture 2.</p>
<h2 id="overview">Overview</h2>
<p>The substitution model is a way of manually evaluating OCaml expressions.
It's similar to, but not identical to,
what the computer does when it evaluates OCaml code.
The point of learning the model is so that you have a good mental framework
for how OCaml code evaluates.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At some point, this model will not be sufficient to explain
all the features of OCaml that we will use
(for instance, updating variables in imperative programming),
so we will define a new model: the <em>environment model</em>.
That model will share many features with the substitution model,
but its handling of name lookup will be much more precise.</p>
<p>The substitution model is adequate to understand
the purely functional subset of OCaml we will use
for the first half of the course.</p>
</div>
<h2 id="desugaring-and-precedence">Desugaring and precedence</h2>
<p>Before evaluating any OCaml code using the substitution model,
the code should first be <em>desugared</em>,
and then operator <em>precedence</em> should be made explicit using parentheses.</p>
<h3 id="desugaring">Desugaring</h3>
<p>The main kind of desugaring we need is to replace expressions of this form:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="o">...</span>
</span></code></pre></div>
<p>with this:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="o">...</span>
</span></code></pre></div>
<p>After desugaring, all <code>let</code> expressions are "simple"
<em>i.e.</em> they bind a single <em>name</em> (here, <code>f</code>)
to a <em>value</em>
(the result of evaluating the expression on the right-hand side
of the <code>=</code>; here, <code>fun x y -&gt; ...</code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we are really being picky, we could desugar this further to:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">fun</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="o">...</span>
</span></code></pre></div>
<p>but we don't require that.  This is because of function <em>currying</em>,
which is the way that OCaml interprets functions with multiple arguments.</p>
<p>We recommend that you don't do this in your written evaluations,
unless you have to for some reason.</p>
</div>
<h3 id="precedence">Precedence</h3>
<p>Operator precedence should be made explicit
by wrapping parentheses around nested operator expressions.
For instance, this code:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">7</span>
</span></code></pre></div>
<p>would become:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="mi">1</span> <span class="o">+</span> <span class="o">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">7</span><span class="o">)</span>
</span></code></pre></div>
<p>The full precedence table of OCaml operators is
<a href="https://v2.ocaml.org/manual/expr.html#ss%3Aprecedence-and-associativity">here</a>.
In most cases, it will be what you would expect.</p>
<p>This step is done
so that there is never any question about
what the operands of an operator are.</p>
<h2 id="the-basic-rule">The basic rule</h2>
<p>To evaluate an OCaml expression:</p>
<ol>
<li>evaluate the <em>operands</em> of the expression</li>
<li>evaluate the <em>operator</em> or <em>function</em> of the expression</li>
<li><em>apply</em> the operator/function to the evaluated operands</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OCaml actually evaluates operands from right-to-left,
in contrast to most languages, which evaluate operands from left-to-right.
Evaluation order is <em>not</em> part of the substitution model,
and shouldn't make any difference.</p>
<p>Similarly, you can evaluate the operator/function
before or after evaluating the operands,
and it won't make any difference in this model.</p>
</div>
<p>The basic rule is used when evaluating
a function call or an operator expression.
Other expressions (such as <code>let</code>, <code>fun</code> and <code>if</code> expressions)
do not use the basic rule; they have their own evaluation rules.
Such expressions are called <em>special forms</em>.</p>
<h2 id="specific-cases-of-the-basic-rule">Specific cases of the basic rule</h2>
<ul>
<li>
<p>Numbers evaluate to themselves: <code>10</code> &rarr; <code>10</code>
  (In fact, any literal data value evaluates to itself;
  that's why it's called "literal".
  For now, we are mostly working with numbers.)</p>
</li>
<li>
<p>Primitive (built-in) functions evaluate
  to the corresponding internal procedure.
  We can write this as either:
  <code>+</code> &rarr; <code>[primitive function +]</code>
  or just <code>+</code> &rarr; <code>+</code></p>
</li>
<li>
<p>Variables that have been previously defined
  are "looked up" (in some unspecified way)
  and evaluate to the value that they were previously bound to.
  (If they weren't bound to a value previously, it's an error.)</p>
</li>
</ul>
<h2 id="let-bound-names"><code>let</code>-bound names</h2>
<p>There are two kinds of <code>let</code>-bound names: top-level and in-expression.
They evaluate differently.</p>
<h3 id="top-level-let-expressions">Top-level <code>let</code> expressions</h3>
<p>A top-level <code>let</code> expression<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> looks like this:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">let</span> <span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>for some variable name <code>&lt;var&gt;</code> and some expression <code>&lt;expr&gt;</code>.
For instance:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
</span></code></pre></div>
<p>To evaluate this, you</p>
<ul>
<li>
<p>evaluate the expression to the right of the <code>=</code> sign
  (here, <code>2 + 3</code>, which evaluates to <code>5</code>);</p>
</li>
<li>
<p>"make an association" or "bind" the name (<code>x</code> here)
  to the value of the evaluated expression (<code>5</code>).
  The details of how to make this association aren't important for now,
  though we'll revisit this later.</p>
</li>
</ul>
<p>In this case, we make an association
between the name <code>x</code> and the value <code>5</code>.
We can also say that we bind <code>x</code> to <code>5</code>.</p>
<p>After this expression is evaluated,
the name <code>x</code> will be bound to the value <code>5</code>
for the rest of the evaluated code,
unless <code>x</code> is given a new binding
with a new top-level <code>let</code> expression.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A new binding for <code>x</code> would be something like:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
</span></code></pre></div>
<p>From then on, any reference to <code>x</code> would get the new value.
This is <em>not</em> the same as assignment in an imperative language,
because it doesn't overwrite the old binding.
Instead, this code creates a <em>new</em> binding to <code>x</code>
which "shadows" the old binding,
but the old binding still exists,
and in some cases can still have effects.</p>
</div>
<h3 id="local-let-expressions">Local <code>let</code> expressions</h3>
<p>A "local" <code>let</code> expression
is a <code>let</code> expression where a name is bound to a value
and then immediately used in another expression, such as this:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="k">in</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span></code></pre></div>
<p>In this case, the name <code>x</code> has a meaning
inside the body of the expression (the <code>x * x</code> part) but not outside.
To evaluate this, you:</p>
<ul>
<li>
<p>evaluate the <em>binding expression</em>
  (here, <code>2 + 3</code>, which evaluates to <code>5</code>),</p>
</li>
<li>
<p>bind the name to the value (here, bind <code>x</code> to <code>5</code>),</p>
</li>
<li>
<p>and evaluate the <em>body expression</em> (here, <code>x * x</code>).</p>
</li>
</ul>
<p>In the body expression, of course,
you can use the name <code>x</code>, which has a value (<code>5</code>).
Outside of this expression,
the name <code>x</code> either has no value (if it wasn't bound before)
or has the value it previously had (if it was).
Remember: you aren't changing a previous binding (to <code>x</code>),
you're creating a new one that is used only in a single expression.</p>
<h2 id="if-expressions"><code>if</code> expressions</h2>
<p><code>if</code> expressions consist of three subexpressions:</p>
<ul>
<li>the <em>test</em> subexpression (between the <code>if</code> and the <code>then</code> keywords)</li>
<li>the <code>then</code> subexpression (between the <code>then</code> and the <code>else</code> keywords)</li>
<li>the <code>else</code> subexpression (everything following the <code>else</code> keyword)</li>
</ul>
<p>They have the following evaluation rule.</p>
<ol>
<li>Evaluate the test subexpression.</li>
<li>If the test subexpression evaluates to <code>true</code>,
   evaluate the <code>then</code> subexpression.</li>
<li>If the test subexpression evaluates to <code>false</code>,
   evaluate the <code>else</code> subexpression.</li>
</ol>
<p>One consequence of this is that you never evaluate
both the <code>then</code> and <code>else</code> subexpressions.
This is why <code>if</code> can't be a function (it's not just the syntax!)<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup></p>
<h3 id="if-without-else"><code>if</code> without <code>else</code></h3>
<p>When writing purely functional code in OCaml,
<code>if</code> expressions always have both a <code>then</code> subexpression
and an <code>else</code> subexpression.
(These are sometimes called the "then clause" and the "else clause".)
With respect to the substitution model, we will always have
<code>else</code> subexpressions in <code>if</code> expressions.</p>
<p>To learn more about how <code>if</code> expressions without <code>else</code> subexpressions work,
see the <a href="../ocaml_cheat_sheet/">OCaml cheat sheet</a>.</p>
<h2 id="fun-expressions"><code>fun</code> expressions</h2>
<p>A <code>fun</code> expression (like <code>fun x y -&gt; x + y</code>) represents an anonymous function.
In the substitution model,
a <code>fun</code> expression is usually the result of
desugaring a regular function definition, like</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></code></pre></div>
<p>which desugars to:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></code></pre></div>
<p><code>fun</code> expressions consist of two parts:</p>
<ul>
<li>the <em>formal parameters</em> of the function (here, <code>x</code> and <code>y</code>),</li>
<li>the <em>body</em> of the function (here, <code>x + y</code>).</li>
</ul>
<p><code>fun</code> expressions are trivial to evaluate:
you basically just leave them alone.
For this reason, in written evaluations you can write:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>fun x y -&gt; x + y  --&gt;  fun x y -&gt; x + y
</span></code></pre></div>
<p>or just:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>fun x y -&gt; x + y  --&gt;  itself
</span></code></pre></div>
<h2 id="function-application">Function application</h2>
<p>Function application is at the heart of the substitution model.
There are two cases.</p>
<h3 id="applying-built-in-functions-or-operators">Applying built-in functions or operators</h3>
<p>Applying a built-in function or operator is simple: you just do it.
For instance:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Evaluate: 2 + 3
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>  2 --&gt; 2
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>  3 --&gt; 3
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>  + --&gt; [primitive function +]
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>  apply + to 2, 3 --&gt; 5
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>Evaluate: abs (-10)
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>  -10 --&gt; -10
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>  abs --&gt; [primitive function abs]
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>  apply abs to -10 --&gt; 10
</span></code></pre></div>
<p>In some cases we'll allow you to shorten lines like</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>abs --&gt; [primitive function abs]
</span></code></pre></div>
<p>to just:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>abs --&gt; abs
</span></code></pre></div>
<p>Don't do this unless we explicitly say it's OK.</p>
<h3 id="applying-user-defined-functions-substitution">Applying user-defined functions: substitution</h3>
<p>Now we come to the "substitution" part of the substitution model.
It happens when you are applying a user-defined function
(which means a <code>fun</code> expression,
or a function which gets desugared to a <code>fun</code> expression) to its arguments
(which have already been evaluated to values,
so they aren't expressions anymore).</p>
<p>The rules for applying user-defined functions are:</p>
<ol>
<li>
<p><em>Substitute</em> the function argument variables (formal parameters)
   with the values given in the call
   everywhere they occur in the function body.</p>
</li>
<li>
<p>Evaluate the resulting expression.</p>
</li>
</ol>
<p>For the most part, the substitution process is straightforward.
For each function parameter,
you substitute the argument value
for the function parameter name in the function body
to get the substituted expression, which you then evaluate.
For instance, this expression:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">)</span> <span class="mi">2</span> <span class="mi">3</span>
</span></code></pre></div>
<p>evaluates as follows:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Evaluate: (fun x y -&gt; x + y) 2 3
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>  2 --&gt; 2
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  3 --&gt; 3
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  (fun x y -&gt; x + y) --&gt; itself
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>  apply (fun x y -&gt; x + y) to 2, 3
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="hll">    substitute 2 for x, 3 for y in x + y --&gt; 2 + 3
</span></span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    evaluate: 2 + 3
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>      2 --&gt; 2
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>      3 --&gt; 3
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>      + --&gt; [primitive function +]
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>      apply + to 2, 3 --&gt; 5
</span></code></pre></div>
<p>You can even evaluate inside a complex expression
(for instance, an <code>if</code> expression):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>Evaluate (fun x y -&gt; if x &gt; y then x + y else x - y) 2 3
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  2 --&gt; 2
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>  3 --&gt; 3
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>  (fun x y -&gt; ...) --&gt; itself
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>  apply (fun x y -&gt; ...) to 2, 3
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="hll">    substitute 2 for x, 3 for y in if x &gt; y then x + y else x - y
</span></span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="hll">    --&gt; if 2 &gt; 3 then 2 + 3 else 2 - 3
</span></span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    evaluate: if 2 &gt; 3 then 2 + 3 else 2 - 3
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>      if is a special form; evaluate 2 &gt; 3
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        2 --&gt; 2
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>        3 --&gt; 3
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        &gt; --&gt; [primitive function &gt;]
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        apply &gt; to 2, 3 --&gt; false
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>      For false case, evaluate else clause: 2 - 3
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        2 --&gt; 2
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        3 --&gt; 3
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        - --&gt; [primitive function -]
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        apply - to 2, 3 --&gt; -1
</span></code></pre></div>
<p>Notice that the substitution goes right inside the <code>if</code> expression,
regardless of which branch of the <code>if</code>
will eventually end up being evaluated.
(Here we also see that for long <code>fun</code> expression bodies,
we can abbreviate them with <code>...</code>.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On the other hand, we can't substitute inside a nested <code>fun</code>
expression in all cases.  See below for more details.</p>
</div>
<h3 id="recursion">Recursion</h3>
<p>Recursion doesn't require any special treatment in the substitution model,
except that you have to replace a function name
with the correct definition of that function when looking up the name.
This is usually obvious, and probably won't cause you any problems.
It can get weird in pathological cases where you redefine a name.
Here's a silly example:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">let</span> <span class="n">factorial</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">(* obviously wrong *)</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c">(* Redefine factorial. *)</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">let</span> <span class="n">factorial</span> <span class="n">n</span> <span class="o">=</span>     <span class="c">(* oops, forgot the &quot;rec&quot; *)</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="mi">1</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>  <span class="k">else</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></code></pre></div>
<p>When evaluating this function, the "recursive" call to <code>factorial</code>
will actually pick up the previous definition of <code>factorial</code>,
and <code>factorial</code> will return <code>0</code> for any input but <code>0</code>.
The solution is to include the <code>rec</code> in the second definition:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">let</span> <span class="n">factorial</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">(* obviously wrong *)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c">(* Redefine factorial. *)</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="k">let</span> <span class="k">rec</span> <span class="n">factorial</span> <span class="n">n</span> <span class="o">=</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="mi">1</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>  <span class="k">else</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></code></pre></div>
<p>Now everything will work correctly
because the <code>rec</code> tells OCaml that any references to <code>factorial</code>
inside the body of <code>factorial</code>
represent the function being defined.<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup></p>
<p>Of course, this normally doesn't come up
because you normally don't redefine functions in a file,
but something like this could happen when defining functions interactively
inside the OCaml interpreter.
This can lead to very peculiar bugs.</p>
<h3 id="nested-fun-expressions-and-shielding">Nested <code>fun</code> expressions and shielding</h3>
<p>The substitution model has to be adjusted
to deal with nested <code>fun</code> expressions.
Here's a simple example:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  <span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
</span></code></pre></div>
<p>How would you evaluate <code>f 3</code>?
Here's a first (wrong) attempt:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Evaluate (f 3)
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>  3 --&gt; 3
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>  f --&gt; fun x -&gt; fun x -&gt; x + x
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>  apply (fun x -&gt; fun x -&gt; x + x) to 3
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    substitute 3 for x in (fun x -&gt; x + x)
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    --&gt; fun 3 -&gt; 3 + 3  (* ??? *)
</span></code></pre></div>
<p>at which point it seems clear that something has gone wrong.</p>
<p>You might think that <code>fun 3 -&gt; 3 + 3</code> is a syntax error,
but that isn't actually the case in OCaml!
The <code>fun</code> form uses pattern-matching to decide
what to do with the arguments,
so <code>fun 3 -&gt; 3 + 3</code> is a function that can only take as its input
the integer <code>3</code>, and will always return 6.
Clearly, this isn't going to be useful,
and is not what was intended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you type in <code>fun 3 -&gt; 3 + 3</code> into the OCaml interpreter,
you'll get a warning about non-exhaustive pattern matches,
as you'd expect.</p>
</div>
<p>OK, so it seems that naively doing substitution in cases like this
(where you have nested <code>fun</code> expressions that use the same argument name)
doesn't work properly.
So how can we fix our model so it can handle situations like this?</p>
<p>The key is to realize that the problems started with this line:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>substitute 3 for x in (fun x -&gt; x + x)
</span></code></pre></div>
<p>Normally, we are substituting a value for a <em>free variable</em>,
which is one that isn't being bound by a <code>fun</code> expression.
However, in the expression <code>fun x -&gt; x + x</code>,
there are two different <code>x</code>s:</p>
<ul>
<li>
<p>the first <code>x</code>, which is in the <em>binding position</em> of the <code>fun</code> expression</p>
</li>
<li>
<p>the second two <code>x</code>s, which are both <em>bound variables</em>,
which means that their value is determined by the (eventual)
value passed to the <code>fun</code> expression as its <code>x</code> argument.</p>
</li>
</ul>
<p>Neither case corresponds to a free variable.
And, as it turns out, we can't substitute into either of them.</p>
<p>We've already seen that when we allow substituting
into the binding position of a <code>fun</code> expression,
strange things like <code>fun 3 -&gt; 3 + 3</code> result.
So it's perfectly reasonable to add an extra rule to the substitution model
which says "don't allow substitutions into the binding position
of <code>fun</code> expressions".  So let's do that:</p>
<div class="admonition note">
<p class="admonition-title">Extra rule for the substitution model</p>
<p>Don't allow substituting into the binding position of a <code>fun</code> expression.</p>
</div>
<p>If we go back to the substitution that gave us grief:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>substitute 3 for x in (fun x -&gt; x + x)
</span></code></pre></div>
<p>then we could do the substitution with the extra rule to get:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>substitute 3 for x in (fun x -&gt; x + x)
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>--&gt; fun x -&gt; 3 + 3
</span></code></pre></div>
<p>This isn't as obviously broken as the previous attempt,
but something is still funny here.
It doesn't seem reasonable that we would want to generate
a function that, given an arbitrary argument <code>x</code>,
would always return <code>6</code>.</p>
<p>In fact, the expression <code>fun x -&gt; x + x</code> is completely self-contained
(other than the <code>+</code> symbol).
It only has one reasonable interpretation:
a function which doubles its input.
So we should disallow substitution into the <code>x</code>s that come after the
arrow (<code>-&gt;</code>) in the <code>fun</code> expression too.
Our rationale for this is that the <code>x</code> in the binding position
"shields" the other <code>x</code>s
(which we refer to as being <em>bound</em> by the <code>x</code>
in the binding position)
from substitution.
So we have yet another rule for the substitution model:</p>
<div class="admonition note">
<p class="admonition-title">Second extra rule for the substitution model</p>
<p>Don't allow substituting into a variable which is shielded
by the same variable in the binding position of a <code>fun</code> expression.</p>
</div>
<p>We can combine both rules into a single rule:</p>
<div class="admonition note">
<p class="admonition-title">Shielding rule for the substitution model</p>
<p>Don't allow substituting into a variable
when it is either in the binding position of a <code>fun</code> expression
or when it is a bound variable of a <code>fun</code> expression.
We say that the variable in the binding position <em>shields</em>
the bound variables from substitution.</p>
</div>
<p>That's basically it for the substitution model.
We will find eventually that this model has limitations
that can only be overcome by switching to a new mode
(the <em>environment model</em>),
which we shall discuss later in the course.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Technically speaking, this isn't a true <em>expression</em>,
since it doesn't return a value.
It would be more accurate to call this a top-level <code>let</code> <em>binding</em>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>In a lazy functional language like Haskell,
<code>if</code> <em>could</em> be a function, except for the syntax.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>This would make an awesome assignment problem,
but I'm not quite that mean.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ocaml_cheat_sheet/" class="md-footer__link md-footer__link--prev" aria-label="Previous: OCaml Cheat Sheet">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                OCaml Cheat Sheet
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>