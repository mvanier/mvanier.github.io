
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/assignments/4/passes/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Assignment 4: Compiler passes - The CS 164 book (Fall 2025)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#assignment-4-compiler-passes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="The CS 164 book (Fall 2025)" class="md-header__button md-logo" aria-label="The CS 164 book (Fall 2025)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The CS 164 book (Fall 2025)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Assignment 4: Compiler passes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to medium mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to medium mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="medium" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18V6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="The CS 164 book (Fall 2025)" class="md-nav__button md-logo" aria-label="The CS 164 book (Fall 2025)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The CS 164 book (Fall 2025)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to CS 164!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/language/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation Language
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administrative
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administrative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin/syllabus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Syllabus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin/collab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Collaboration policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admin/groups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Groups
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OCaml
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            OCaml
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing OCaml
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/macos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notes on MacOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coding notes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Coding notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Style tips
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Formatting your code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic tips
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional programming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Type annotations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/poly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polymorphic variants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/new_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    New features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design tips
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ocaml/notes/sexp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    S-expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Assignments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Assignments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment 0: Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Assignment 1: Var
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Assignment 1: Var
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1/passes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiler passes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-passes-that-are-unchanged-from-the-previous-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      A. Passes that are unchanged from the previous assignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-passes-that-have-minimal-modifications-from-the-previous-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      B. Passes that have minimal modifications from the previous assignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-passes-that-are-new" class="md-nav__link">
    <span class="md-ellipsis">
      C. Passes that are new
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C. Passes that are new">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uncover-get-uncover_getml" class="md-nav__link">
    <span class="md-ellipsis">
      Uncover get! (uncover_get.ml)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#d-passes-with-significant-modifications-from-the-previous-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      D. Passes with significant modifications from the previous assignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="D. Passes with significant modifications from the previous assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-remove-complex-operands-remove_complexml" class="md-nav__link">
    <span class="md-ellipsis">
      1. Remove complex operands (remove_complex.ml)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-explicate-control-explicate_controlml" class="md-nav__link">
    <span class="md-ellipsis">
      2. Explicate control (explicate_control.ml)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-select-instructions-select_instructionsml" class="md-nav__link">
    <span class="md-ellipsis">
      3. Select instructions (select_instructions.ml)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-uncover-live-uncover_liveml" class="md-nav__link">
    <span class="md-ellipsis">
      4. Uncover live (uncover_live.ml)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="assignment-4-compiler-passes">Assignment 4: Compiler passes</h1>
<p>The compiler passes are described in chapter 5 of the textbook
and in the lectures,
but here they are again for completeness.
(You should still read the book and lectures for a more in-depth explanation!)
We will only include passes that you have to implement.
As before, the only files you should modify are the <code>.ml</code> files
corresponding to these compiler passes.</p>
<h2 id="a-passes-that-are-unchanged-from-the-previous-assignment">A. Passes that are unchanged from the previous assignment</h2>
<p>These passes are identical except possibly for the names of imported
modules (<code>e.g.</code> <code>Cif</code> changing to <code>Cloop</code>).</p>
<ul>
<li>remove unused blocks</li>
<li>build interference graph</li>
<li>graph coloring</li>
<li>allocate registers</li>
<li>remove jumps (but see note below)</li>
<li>patch instructions</li>
<li>add prelude and conclusion</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The "remove jumps" pass may or may not require modifications,
depending on how you implemented it in the previous assignment.
If you took advantage of the topological ordering of blocks
in that assignment,
you'll have to change that here.
If not, you won't.</p>
</div>
<h2 id="b-passes-that-have-minimal-modifications-from-the-previous-assignment">B. Passes that have minimal modifications from the previous assignment</h2>
<p>These passes have to be extended to handle the new forms,
but the extensions should be straightforward.</p>
<ul>
<li>
<p>shrink</p>
</li>
<li>
<p>uniquify</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the "uniquify" pass,
note that <code>set!</code> requires the variable being set
to have already been renamed.
Otherwise, signal an error.</p>
</div>
<h2 id="c-passes-that-are-new">C. Passes that are new</h2>
<h3 id="uncover-get-uncover_getml">Uncover <code>get!</code> (<code>uncover_get.ml</code>)</h3>
<p>This pass is discussed in lecture 13 and in the textbook.
The idea is to annotate any variable expression that corresponds
to a variable which is reassigned by <code>set!</code>.
Such variables are converted to <code>get!</code> expressions,
so <code>Var x</code> becomes <code>GetBang x</code>.
This is used in the "remove complex operands" pass,
as described in lecture 13.</p>
<p>Implementing this pass is quite simple.  You go through the code twice.
The first time, you collect a set of all the variables that are assigned to
in a <code>set!</code> expression.  The second time,
you convert any variable reference to one of these variables
to a <code>get!</code> (<code>GetBang</code>) form.
Since variable names are unique (thanks to the "uniquify" pass),
any reference to a variable which is assigned to in a <code>set!</code> expression
must refer to the same variable as any reference to that variable.</p>
<h2 id="d-passes-with-significant-modifications-from-the-previous-assignment">D. Passes with significant modifications from the previous assignment</h2>
<h3 id="1-remove-complex-operands-remove_complexml">1. Remove complex operands (<code>remove_complex.ml</code>)</h3>
<p>In this pass, the <code>set!</code>, <code>begin</code>, and <code>while</code> forms
are all considered to be complex operands.
In addition, the subexpressions of <code>set!</code>, <code>begin</code>, and <code>while</code>
are allowed to be complex.
Also, <code>Void</code> has to be added as an additional case.</p>
<p>The <code>get!</code> (<code>GetBang</code>) form added in the "uncover get" pass
is converted back to a regular variable (<code>Var</code>) in this pass.
In <code>rco_atom</code>, the variable is bound to a new fresh variable name
which becomes the atom returned from the function.
In <code>rco_exp</code>, the variable is simply the returned expression.</p>
<p>It's legal to pass <code>set!</code> and <code>while</code> expressions to the
<code>rco_atom</code> function, since they return <code>Void</code> values.
These would not normally be function arguments,
but we handle this case for completeness.
In such cases, <code>rco_atom</code> returns the <code>Void</code> atom,
and binds the expression to the dummy variable <code>$_</code>,
which will never be accessed.</p>
<h3 id="2-explicate-control-explicate_controlml">2. Explicate control (<code>explicate_control.ml</code>)</h3>
<!--
TODO:

Write out the transformations that are done in this pass,
and are documented in the code comments.

-->

<p>The following changes need to be made to the "explicate control" pass.</p>
<ul>
<li>
<p>New forms need to be handled in <code>convert_atom</code> and <code>convert_exp</code>.
  This should be straightforward.</p>
</li>
<li>
<p>The new <code>while</code>, <code>begin</code>, and <code>set!</code> forms need to be handled
  in <code>explicate_assign</code>.  Both the <code>while</code> and <code>begin</code> forms
  have side effects; these are handled in the new <code>explicate_effect</code>
  function described below, and that function is called from
  <code>explicate_assign</code>.  The return value of <code>begin</code> is the return value
  of the last expression; all others are evaluated for side effects.
  The return values of <code>while</code> and <code>set!</code> are <code>Void</code>.
  Make sure to accumulate the subexpressions of <code>begin</code> in the correct order.
  (Hint: the <code>List.fold_right</code> function will be useful.)</p>
</li>
<li>
<p>The <code>explicate_pred</code> function has to be extended to deal with
  the <code>while</code>, <code>begin</code>, and <code>set!</code> forms.
  Since <code>while</code> and <code>set!</code> can only return <code>Void</code>, not booleans,
  handling them is easy: it's an error.
  A <code>begin</code> can return a boolean, but the subexpressions need to 
  be handled first, and in the correct order.</p>
</li>
<li>
<p>The <code>explicate_tail</code> function has to be extended to deal with
  the <code>while</code>, <code>begin</code>, and <code>set!</code> forms.
  This will involve calls to <code>explicate_assign</code> and/or <code>explicate_effect</code>
  as needed.</p>
</li>
<li>
<p>The new function <code>explicate_effect</code> has been added to deal with forms
  that have side effects.  Note that any form can be in a side-effecting
  position (<code>e.g.</code> inside a <code>begin</code> expression), even ones that
  have no side effects.  These pure expressions should be discarded
  because they have no effect.
  Effectful primitives (<code>read</code> and <code>print</code>) can be converted using
  the <code>PrimS</code> constructor.
  Converting the rest of the forms should be straightforward,
  with the exception of the <code>if</code> and <code>while</code> forms.</p>
</li>
</ul>
<p>The form <code>(if &lt;test&gt; &lt;then&gt; &lt;else&gt;)</code>, when evaluated for its effects,
  is going to either evaluate the <code>&lt;then&gt;</code> clause or the <code>&lt;else&gt;</code>
  clause for its effects.  That means that those clauses will have to
  be processed by <code>explicate_effect</code> as well.  When doing this,
  be careful not to duplicate the original tail passed to the
  <code>explicate_effect</code> function; to avoid that, make it into a block
  and use a <code>Goto</code> to that block.</p>
<p>The form <code>(while &lt;test&gt; &lt;body&gt;)</code> followed by a tail <code>tail</code>
  should be converted to the equivalent of this code:</p>
<div class="language-text highlight"><pre><span></span><code>```
loop:
  if test then
    body
    goto loop
  else
    tail
```
</code></pre></div>
<p>You will need to generate the loop label (marked as <code>loop</code> here).
  Use the <code>fresh</code> function as you did in the <code>uniquify</code> pass
  with the base <code>loop</code> and the separator <code>_</code>
  so you get <code>loop_N</code> for some number <code>N</code>.</p>
<p>The body of the loop is evaluated only for its effects,
  so it has to be processed by <code>explicate_effect</code>.
  The <code>if</code> equivalent form has to be processed by <code>explicate_pred</code>,
  returning a tail which constitutes a basic block.
  The loop label will correspond to this block;
  this has to be added to the <code>basic_blocks</code> variable
  and a <code>Goto</code> to this block's label should be returned.
  (Don't call <code>create_block</code> here, since <code>explicate_pred</code>
  will do this if necessary.)</p>
<p>See section 5.6 in the book for further discussion of this.</p>
<h3 id="3-select-instructions-select_instructionsml">3. Select instructions (<code>select_instructions.ml</code>)</h3>
<p>The following changes need to be made to the "select instructions" pass.</p>
<ul>
<li>
<p>A <code>Void</code> expression becomes the integer <code>0</code>.</p>
</li>
<li>
<p>A <code>Read</code> can be a stand-alone statement, as well as an expression.
  Stand-alone statements use the new <code>PrimS</code> constructor
  of the "Cloop" intermediate language.</p>
</li>
<li>
<p>The <code>Print</code> function we added can also be a stand-alone statement.
  (Note that <code>Print</code> is our addition; it's not in the textbook.)
  Its return value (<code>Void</code>) can also be assigned to a variable,
  and it can be a tail expression.
  <code>Print</code> takes one argument, which must be placed into
  the <code>%rdi</code> register before calling the function.</p>
</li>
</ul>
<p>Note that just as <code>read</code> in the source language becomes <code>read_int</code>
in assembly language, <code>print</code> in the source language
becomes <code>print_int</code> in assembly language.</p>
<h3 id="4-uncover-live-uncover_liveml">4. Uncover live (<code>uncover_live.ml</code>)</h3>
<p>The only parts of the "uncover live" pass that have changed are:</p>
<ul>
<li>
<p>The <code>order_labels</code> function has been replaced
  with the <code>compute_liveness</code> function,
  which uses the dataflow analysis described
  in sections 5.2 and 5.8 of the textbook,
  and also in lecture 14.
  This function iteratively computes the live-before sets of all blocks
  until it reaches a fixpoint.
  This is necessary because the control flow graph
  is no longer a directed acyclic graph
  in the presence of looping constructs,
  so we can't use a topological sort as we did in the previous compiler.</p>
</li>
<li>
<p>The <code>uncover_live</code> function has been modified to use the
  <code>compute_liveness</code> function.
  Note that this function is supplied to you in its entirety
  (which wasn't the case in the previous assignment's compiler),
  because the steps are straightforward.</p>
</li>
</ul>
<p>Therefore, your job for this pass
is to implement the <code>compute_liveness</code> function.
The algorithm is described in some detail
in the comment preceding the function.
This algorithm is not extremely difficult,
but we recommend that you use the <code>_debug</code> variable
and print out various important data structures
if debugging is enabled.
For one thing, you should check that the algorithm
really does converge to a final state.</p>
<p>The <code>_debug</code> variable (which is a <code>ref</code>, but doesn't really need to be)
is for your benefit.  If you want to put in debugging code that can be
switched off, you can write something like this:</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">if</span> <span class="o">!_</span><span class="n">debug</span> <span class="k">then</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>   <span class="c">(* print a debug message *)</span>
</span></code></pre></div>
<p>If the <code>_debug</code> variable is set to <code>true</code>,
the debug messages will be printed.
If it's set to <code>false</code>, they won't be.
If you change it, you have to recompile your code for it to take effect.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.footer", "navigation.top"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>