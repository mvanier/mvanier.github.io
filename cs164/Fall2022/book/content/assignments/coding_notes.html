<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OCaml coding notes &mdash; The CS 164 book 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Installing OCaml" href="0/Installing_OCaml.html" />
    <link rel="prev" title="Assignments" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The CS 164 book
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Administrative information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Assignments</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">OCaml coding notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#warnings">Warnings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functional-style-by-default">Functional style by default</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nested-pattern-matching">Nested pattern matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#folds-are-your-friend">Folds are your friend!</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#left-vs-right-folds">Left <em>vs.</em> right folds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0/Installing_OCaml.html">Installing OCaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="0/Assignment0.html">Assignment 0: Getting set up</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The CS 164 book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Assignments</a> &raquo;</li>
      <li>OCaml coding notes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/content/assignments/coding_notes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="ocaml-coding-notes">
<h1>OCaml coding notes<a class="headerlink" href="#ocaml-coding-notes" title="Permalink to this heading"></a></h1>
<p>Here are some tips that should improve your OCaml programming experience.</p>
<div class="section" id="warnings">
<h2>Warnings<a class="headerlink" href="#warnings" title="Permalink to this heading"></a></h2>
<p>Warnings are always bad, unless you expect them (<em>e.g.</em> because code is only
partially written).  Never ignore warnings.  Your finished code should <em>never</em>
generate warnings.</p>
</div>
<div class="section" id="functional-style-by-default">
<h2>Functional style by default<a class="headerlink" href="#functional-style-by-default" title="Permalink to this heading"></a></h2>
<p>Code should be written in a functional style (no <code class="docutils literal notranslate"><span class="pre">ref</span></code>s, arrays, or records
with mutable fields) except where indicated.  Marks will be taken off if this
rule is violated.  We will let you know when it’s OK to use imperative idioms.
Certain imperative idioms (like <code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">for</span></code> loops) are almost never
used, but we do use <code class="docutils literal notranslate"><span class="pre">ref</span></code> cells on occasion to make code simpler.</p>
<p>Many of the tips below describe ways to effectively use functional style.</p>
</div>
<div class="section" id="nested-pattern-matching">
<h2>Nested pattern matching<a class="headerlink" href="#nested-pattern-matching" title="Permalink to this heading"></a></h2>
<p>It’s very common to want to write a pattern match inside another
pattern match.  There are two cases to consider.</p>
<ol class="arabic">
<li><p>Where the two pattern matches can be combined.  Consider this code:</p>
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">maybe_lst</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span> <span class="n">option</span><span class="o">)</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">maybe_lst</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="nc">None</span>
    <span class="o">|</span> <span class="nc">Some</span> <span class="n">lst</span> <span class="o">-&gt;</span>
      <span class="k">begin</span>
        <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
          <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="n">h</span>
          <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="nc">None</span>
      <span class="k">end</span>
</pre></div>
</div>
<p>You can merge both pattern matches as follows:</p>
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">maybe_lst</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span> <span class="n">option</span><span class="o">)</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">option</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">maybe_lst</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Some</span> <span class="o">(</span><span class="n">h</span> <span class="o">::</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="n">h</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
</pre></div>
</div>
<p>Note how much shorter and clearer the code is.
Also note the use of the wildcard (<code class="docutils literal notranslate"><span class="pre">_</span></code>) pattern
for “don’t care” situations.</p>
<p>Merging pattern matches is almost always possible if the
inner pattern match doesn’t depend on a value computed using
information from the outer pattern match.
Unnecessary pattern matches are bad style and will be marked down.</p>
</li>
<li><p>Where the two pattern matches <em>can’t</em> be combined.
Consider this code:</p>
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">lst</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
    <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
      <span class="k">begin</span>
        <span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="n">t</span> <span class="k">with</span>
          <span class="o">|</span> <span class="n">h&#39;</span> <span class="o">::</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">h&#39;</span><span class="o">)</span>
          <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
      <span class="k">end</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
</pre></div>
</div>
<p>The inner match is matching on the result of the <code class="docutils literal notranslate"><span class="pre">List.sort</span></code>
function applied to the tail of the list.
You can’t combine these pattern matches because the inner one
depends on a value which must be computed (it’s not structural).
For very simple cases, you can use a <code class="docutils literal notranslate"><span class="pre">when</span></code> clause instead of
the inner match, but often this isn’t feasible.
So you have nested <code class="docutils literal notranslate"><span class="pre">match</span></code> expressions.</p>
<p>When you have nested <code class="docutils literal notranslate"><span class="pre">match</span></code> expressions, you must surround them
by either <code class="docutils literal notranslate"><span class="pre">begin</span></code>/<code class="docutils literal notranslate"><span class="pre">end</span></code> delimiters (as we did above) or parentheses,
which looks like this:</p>
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">lst</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
    <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
      <span class="o">(</span><span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="n">t</span> <span class="k">with</span>
         <span class="o">|</span> <span class="n">h&#39;</span> <span class="o">::</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">h&#39;</span><span class="o">)</span>
         <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span><span class="o">)</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
</pre></div>
</div>
<p>Using parentheses looks more concise, but it’s easy to forget to close
the open parenthesis, so we prefer to use <code class="docutils literal notranslate"><span class="pre">begin</span></code>/<code class="docutils literal notranslate"><span class="pre">end</span></code>.
(It reads better, too.)  What you definitely do <em>not</em> want to do is this:</p>
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">lst</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">int</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">lst</span> <span class="k">with</span>
    <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
      <span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="n">t</span> <span class="k">with</span>
        <span class="o">|</span> <span class="n">h&#39;</span> <span class="o">::</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">h&#39;</span><span class="o">)</span>
        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
</pre></div>
</div>
<p>If you do this, you will get strange error messages because
OCaml will consider the last line to be part of the inner pattern match.
Remember, <strong>OCaml is not whitespace sensitive!</strong>
So don’t forget the <code class="docutils literal notranslate"><span class="pre">begin</span></code>/<code class="docutils literal notranslate"><span class="pre">end</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="folds-are-your-friend">
<h2>Folds are your friend!<a class="headerlink" href="#folds-are-your-friend" title="Permalink to this heading"></a></h2>
<p>Programmers new to OCaml are often frustrated by what they perceive as the
difficulty of doing simple things.  A good example of this is accumulation.
You have a list and want to compute some value from the list elements.
For instance, say you want to get the maximum value of the list (and assume
that you only have a two-element <code class="docutils literal notranslate"><span class="pre">max</span></code> function to compute maximums).
A Python programmer could immediately write this code:</p>
<blockquote>
<div><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the maximum of a list of positive integers.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">mx</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mx</span>
</pre></div>
</div>
</div></blockquote>
<p>In OCaml, we do this sort of thing using folds, specifically left folds.</p>
<blockquote>
<div><div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">max_list</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">mx</span> <span class="n">item</span> <span class="o">-&gt;</span> <span class="n">max</span> <span class="n">mx</span> <span class="n">item</span><span class="o">)</span>
    <span class="mi">0</span>
    <span class="n">lst</span>
</pre></div>
</div>
</div></blockquote>
<p>This can be simplified further:</p>
<blockquote>
<div><div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">max_list</span> <span class="n">lst</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="n">max</span> <span class="mi">0</span> <span class="n">lst</span>
</pre></div>
</div>
</div></blockquote>
<p>Whenever you need to write code which accumulates something over a list,
you want to use a fold.</p>
<div class="section" id="left-vs-right-folds">
<h3>Left <em>vs.</em> right folds<a class="headerlink" href="#left-vs-right-folds" title="Permalink to this heading"></a></h3>
<p>95% of the time or more, if you want to use a fold in OCaml,
you want to use a left fold (<code class="docutils literal notranslate"><span class="pre">List.fold_left</span></code>)
instead of a right fold (<code class="docutils literal notranslate"><span class="pre">List.fold_right</span></code>).
Left folds are tail-recursive (space efficient) and are more natural
than right folds, which are also less space efficient.</p>
<p>On the other hand, there are cases where right folds are the right thing to
use.  When you want to accumulate things in a list from the right going back
to the left, a right fold is usually going to be simpler than a left fold,
and you shouldn’t feel bad about using one.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Assignments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="0/Installing_OCaml.html" class="btn btn-neutral float-right" title="Installing OCaml" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Michael C. Vanier. All rights reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>